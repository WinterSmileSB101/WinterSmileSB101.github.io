<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans,zh-hk,en,fr-FR,ru,de,ja,id,ko,default">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="WinterSmileSB101 的个人房间" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="成都工业学院14级，学习了各种后台技能，对前端也甚是抱有好感，准备再入坑前端。">
<meta property="og:type" content="website">
<meta property="og:title" content="WinterSmileSB101 的个人房间">
<meta property="og:url" content="http://WinterSmileSB101.online/index.html">
<meta property="og:site_name" content="WinterSmileSB101 的个人房间">
<meta property="og:description" content="成都工业学院14级，学习了各种后台技能，对前端也甚是抱有好感，准备再入坑前端。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="WinterSmileSB101 的个人房间">
<meta name="twitter:description" content="成都工业学院14级，学习了各种后台技能，对前端也甚是抱有好感，准备再入坑前端。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://WinterSmileSB101.online/"/>





  <title> WinterSmileSB101 的个人房间 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">WinterSmileSB101 的个人房间</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">胆小认生，不易相处</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://WinterSmileSB101.online/2017/03/23/node-spider-scend/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WinterSmileSB101">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WinterSmileSB101 的个人房间">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/23/node-spider-scend/" itemprop="url">
                  一起学爬虫 Node.js 爬虫篇（二）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-23T17:17:58+08:00">
                2017-03-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/爬虫/" itemprop="url" rel="index">
                    <span itemprop="name">爬虫</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/爬虫/Node-js-爬虫/" itemprop="url" rel="index">
                    <span itemprop="name">Node.js 爬虫</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>版权声明：本文为 wintersmilesb101 -（个人独立博客– <a href="http://wintersmilesb101.online">http://wintersmilesb101.online</a> 欢迎访问）博主原创文章，未经博主允许不得转载。</p>
</blockquote>
<h4 id="上一篇中我们对百度首页进行了标题的爬取，本来打算这次直接对上次没有爬取到的推荐新闻进行爬取，谁知道网页加载出来没网页了，这是天要亡我大宋啊。。那我们直接去抓取网易新闻，进入网易新闻-我们要抓取的位置如下"><a href="#上一篇中我们对百度首页进行了标题的爬取，本来打算这次直接对上次没有爬取到的推荐新闻进行爬取，谁知道网页加载出来没网页了，这是天要亡我大宋啊。。那我们直接去抓取网易新闻，进入网易新闻-我们要抓取的位置如下" class="headerlink" title="上一篇中我们对百度首页进行了标题的爬取，本来打算这次直接对上次没有爬取到的推荐新闻进行爬取，谁知道网页加载出来没网页了，这是天要亡我大宋啊。。那我们直接去抓取网易新闻，进入网易新闻,我们要抓取的位置如下:"></a>上一篇中我们对百度首页进行了标题的爬取，本来打算这次直接对上次没有爬取到的推荐新闻进行爬取，谁知道网页加载出来没网页了，这是天要亡我大宋啊。。那我们直接去抓取网易新闻，进入网易新闻,我们要抓取的位置如下:</h4><p><img src="http://on792ofrp.bkt.clouddn.com/17-3-23/34448525-file_1490261201810_807e.png" alt="image"></p>
<h4 id="首先来上爬取网站的测试"><a href="#首先来上爬取网站的测试" class="headerlink" title="首先来上爬取网站的测试"></a>首先来上爬取网站的测试</h4><h5 id="1-先按下-F12-点击-Network-就会弹出网络请求界面-从这个界面我们看是否有-Ajax-请求-如果有那么就试着伪造请求来获取数据（这样获取的数据很直接，一般都是-json-格式很清晰），伪造不了就使用-pathomjs-来进行网络请求实现抓取。"><a href="#1-先按下-F12-点击-Network-就会弹出网络请求界面-从这个界面我们看是否有-Ajax-请求-如果有那么就试着伪造请求来获取数据（这样获取的数据很直接，一般都是-json-格式很清晰），伪造不了就使用-pathomjs-来进行网络请求实现抓取。" class="headerlink" title="1.先按下 F12 点击 Network,就会弹出网络请求界面,从这个界面我们看是否有 Ajax 请求,如果有那么就试着伪造请求来获取数据（这样获取的数据很直接，一般都是 json 格式很清晰），伪造不了就使用 pathomjs 来进行网络请求实现抓取。"></a>1.先按下 F12 点击 Network,就会弹出网络请求界面,从这个界面我们看是否有 Ajax 请求,如果有那么就试着伪造请求来获取数据（这样获取的数据很直接，一般都是 json 格式很清晰），伪造不了就使用 pathomjs 来进行网络请求实现抓取。</h5><p><img src="http://on792ofrp.bkt.clouddn.com/17-3-23/71601232-file_1490261572369_3333.png" alt="image"></p>
<h4 id="这里可以看到我们的网络请求获取的数据并不为空，那么我们直接对网页的网络加载进行分析，红框的位置就是数据的请求"><a href="#这里可以看到我们的网络请求获取的数据并不为空，那么我们直接对网页的网络加载进行分析，红框的位置就是数据的请求" class="headerlink" title="这里可以看到我们的网络请求获取的数据并不为空，那么我们直接对网页的网络加载进行分析，红框的位置就是数据的请求"></a>这里可以看到我们的网络请求获取的数据并不为空，那么我们直接对网页的网络加载进行分析，红框的位置就是数据的请求</h4><p><img src="http://on792ofrp.bkt.clouddn.com/17-3-23/59803470-file_1490274042701_67ae.png" alt="image"></p>
<h4 id="直接拖拽打开请求网址-先点击-header-然后就可以看到网址"><a href="#直接拖拽打开请求网址-先点击-header-然后就可以看到网址" class="headerlink" title="直接拖拽打开请求网址(先点击 header 然后就可以看到网址)"></a>直接拖拽打开请求网址(先点击 header 然后就可以看到网址)</h4><p><img src="http://on792ofrp.bkt.clouddn.com/17-3-23/47264701-file_1490274230870_3177.png" alt="image"></p>
<h4 id="打开页面如下"><a href="#打开页面如下" class="headerlink" title="打开页面如下"></a>打开页面如下</h4><p><img src="http://on792ofrp.bkt.clouddn.com/17-3-23/64554156-file_1490274698606_1257.png" alt="image"></p>
<h4 id="是不是很激动，这不就是数据嘛，还是-json-的，简直比获取网页源码还还解析，直接上代码"><a href="#是不是很激动，这不就是数据嘛，还是-json-的，简直比获取网页源码还还解析，直接上代码" class="headerlink" title=",是不是很激动，这不就是数据嘛，还是 json 的，简直比获取网页源码还还解析，直接上代码"></a>,是不是很激动，这不就是数据嘛，还是 json 的，简直比获取网页源码还还解析，直接上代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">var request = require(<span class="string">"request"</span>);</div><div class="line">var cheerio = require(<span class="string">"cheerio"</span>);</div><div class="line">request(<span class="string">'http://news.163.com/'</span>,function(err,result)&#123;</div><div class="line">    <span class="keyword">if</span>(err)&#123;</div><div class="line">        console.log(<span class="string">"错误："</span>+err);</div><div class="line">    &#125;</div><div class="line">    console.log(result.body);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h5 id="然后运行测试，可以看到这里我们获取的页面产生了乱码"><a href="#然后运行测试，可以看到这里我们获取的页面产生了乱码" class="headerlink" title="然后运行测试，可以看到这里我们获取的页面产生了乱码"></a>然后运行测试，可以看到这里我们获取的页面产生了乱码</h5><p><img src="http://on792ofrp.bkt.clouddn.com/17-3-23/74210596-file_1490261772161_113e7.png" alt="image"></p>
<h5 id="如何解决乱码？有两种方式"><a href="#如何解决乱码？有两种方式" class="headerlink" title="如何解决乱码？有两种方式"></a>如何解决乱码？有两种方式</h5><h6 id="1-这里就需要使用到另外的库-superagent-以及-superagent-charset"><a href="#1-这里就需要使用到另外的库-superagent-以及-superagent-charset" class="headerlink" title="1.这里就需要使用到另外的库 superagent 以及 superagent-charset"></a>1.这里就需要使用到另外的库 superagent 以及 superagent-charset</h6><h6 id="安装方式"><a href="#安装方式" class="headerlink" title="安装方式"></a>安装方式</h6><figure class="highlight cmd"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">npm install superagent --save</div><div class="line">npm install superagent-charset</div></pre></td></tr></table></figure>
<h6 id="然后改写代码如下"><a href="#然后改写代码如下" class="headerlink" title="然后改写代码如下"></a>然后改写代码如下</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> install = require(<span class="string">'superagent-charset'</span>);</div><div class="line"><span class="keyword">const</span> request = require(<span class="string">'superagent'</span>);</div><div class="line">superagent = install(request);</div><div class="line">superagent.get(<span class="string">'http://news.163.com/'</span>).charset(<span class="string">'gb2312'</span>).end(function(err,res) &#123;</div><div class="line">	<span class="keyword">if</span>(err) console.log(err);</div><div class="line">        console.log(res.text);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h5 id="然后运行，如下成功转码"><a href="#然后运行，如下成功转码" class="headerlink" title="然后运行，如下成功转码"></a>然后运行，如下成功转码</h5><p><img src="http://on792ofrp.bkt.clouddn.com/17-3-23/97516487-file_1490268273791_eb52.png" alt="image"></p>
<h5 id="2-就直接对-request-配合-iconv-lite"><a href="#2-就直接对-request-配合-iconv-lite" class="headerlink" title="2.就直接对 request 配合 iconv-lite"></a>2.就直接对 request 配合 iconv-lite</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install iconv-lite</div></pre></td></tr></table></figure>
<h5 id="然后修改代码，如下"><a href="#然后修改代码，如下" class="headerlink" title="然后修改代码，如下"></a>然后修改代码，如下</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">var request = require(<span class="string">'request'</span>);</div><div class="line">var cheerio = require(<span class="string">'cheerio'</span>);</div><div class="line">var iconv = require(<span class="string">'iconv-lite'</span>);</div><div class="line">request.get(&#123;</div><div class="line">    url : <span class="string">'http://temp.163.com/special/00804KVA/cm_yaowen.js?callback=data_callback'</span>,</div><div class="line">    encoding : <span class="keyword">null</span> <span class="comment">//让body 直接是buffer</span></div><div class="line">&#125;, function (err, response, body) &#123;</div><div class="line">    <span class="comment">//返回的body 直接就是buffer 了...</span></div><div class="line">    var buf =  iconv.decode(body, <span class="string">'gb2312'</span>);</div><div class="line">    console.log(buf);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h5 id="然后运行，如下成功转码-1"><a href="#然后运行，如下成功转码-1" class="headerlink" title="然后运行，如下成功转码"></a>然后运行，如下成功转码</h5><p><img src="http://on792ofrp.bkt.clouddn.com/17-3-23/9069553-file_1490273522605_e993.png" alt="image"></p>
<h4 id="终于可以开始进入正题了，我怕拉闸"><a href="#终于可以开始进入正题了，我怕拉闸" class="headerlink" title="终于可以开始进入正题了，我怕拉闸"></a><strong>终于可以开始进入正题了，我怕拉闸</strong></h4><h4 id="来解析网页，我们来分析分析要取到合适位置需要做些什么-这是个-json-字符串，结构如下所示"><a href="#来解析网页，我们来分析分析要取到合适位置需要做些什么-这是个-json-字符串，结构如下所示" class="headerlink" title="来解析网页，我们来分析分析要取到合适位置需要做些什么,这是个 json 字符串，结构如下所示"></a>来解析网页，我们来分析分析要取到合适位置需要做些什么,这是个 json 字符串，结构如下所示</h4><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">data(</div><div class="line">[</div><div class="line">  &#123;</div><div class="line">    title:'Node.js爬虫爬坑之路',</div><div class="line">    date:'2017-03',</div><div class="line">    athour:'wintersmilesb101',</div><div class="line">    blog:'wintersmilesb101.online'</div><div class="line">  &#125;</div><div class="line">]</div><div class="line">)</div></pre></td></tr></table></figure>
<h4 id="所以我们要做如下工作，先把外面的-data-去掉，然后通过-JSON-parse-String-把-json-字符串转换成-json-对象，然后我们就可以对变量直接进行操作了，是不是很方便"><a href="#所以我们要做如下工作，先把外面的-data-去掉，然后通过-JSON-parse-String-把-json-字符串转换成-json-对象，然后我们就可以对变量直接进行操作了，是不是很方便" class="headerlink" title="所以我们要做如下工作，先把外面的 data() 去掉，然后通过 JSON.parse(String) 把 json 字符串转换成 json 对象，然后我们就可以对变量直接进行操作了，是不是很方便"></a>所以我们要做如下工作，先把外面的 data() 去掉，然后通过 JSON.parse(String) 把 json 字符串转换成 json 对象，然后我们就可以对变量直接进行操作了，是不是很方便</h4><h4 id="代码如下，运行"><a href="#代码如下，运行" class="headerlink" title="代码如下，运行"></a>代码如下，运行</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">var request = require(<span class="string">'request'</span>);</div><div class="line">var iconv = require(<span class="string">'iconv-lite'</span>);</div><div class="line">request.get(&#123;</div><div class="line">    url : <span class="string">'http://temp.163.com/special/00804KVA/cm_yaowen.js?callback=data_callback'</span>,</div><div class="line">    encoding : <span class="keyword">null</span> <span class="comment">//让body 直接是buffer</span></div><div class="line">&#125;, function (err, response, body) &#123;</div><div class="line">    <span class="comment">//返回的body 直接就是buffer 了...</span></div><div class="line">    var buf =  iconv.decode(body, <span class="string">'gb2312'</span>);</div><div class="line">    <span class="comment">//去掉头部的 data_callback(</span></div><div class="line">    var str = buf.replace(<span class="string">'data_callback('</span>,<span class="string">''</span>);</div><div class="line">    <span class="comment">//去掉尾部的 )</span></div><div class="line">    str = str.replace(<span class="string">')'</span>,<span class="string">''</span>);</div><div class="line">    <span class="comment">//遍历输出数据，输出标题测试</span></div><div class="line">    var str1 = JSON.parse(str);</div><div class="line">    str1.forEach(function(s)&#123;</div><div class="line">      console.log(s.title);</div><div class="line">    &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h4 id="成功输出了！接着我们来补全我们的输出"><a href="#成功输出了！接着我们来补全我们的输出" class="headerlink" title="成功输出了！接着我们来补全我们的输出"></a>成功输出了！接着我们来补全我们的输出</h4><p><img src="http://on792ofrp.bkt.clouddn.com/17-3-23/72938976-file_1490278799901_124ee.png" alt="image"></p>
<h4 id="修改后代码如下"><a href="#修改后代码如下" class="headerlink" title="修改后代码如下"></a>修改后代码如下</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">var request = require(<span class="string">'request'</span>);</div><div class="line">var iconv = require(<span class="string">'iconv-lite'</span>);</div><div class="line">request.get(&#123;</div><div class="line">    url : <span class="string">'http://temp.163.com/special/00804KVA/cm_yaowen.js?callback=data_callback'</span>,</div><div class="line">    encoding : <span class="keyword">null</span> <span class="comment">//让body 直接是buffer</span></div><div class="line">&#125;, function (err, response, body) &#123;</div><div class="line">    <span class="comment">//返回的body 直接就是buffer 了...</span></div><div class="line">    var buf =  iconv.decode(body, <span class="string">'gb2312'</span>);</div><div class="line">    <span class="comment">//去掉头部的 data_callback(</span></div><div class="line">    var str = buf.replace(<span class="string">'data_callback('</span>,<span class="string">''</span>);</div><div class="line">    <span class="comment">//去掉尾部的 )</span></div><div class="line">    str = str.replace(<span class="string">')'</span>,<span class="string">''</span>);</div><div class="line">    var str1 = JSON.parse(str);</div><div class="line">    str1.forEach(function(s)&#123;</div><div class="line">      console.log(<span class="string">'文章标题：'</span>+s.title);</div><div class="line">      console.log(<span class="string">'摘要：'</span>s.digest);</div><div class="line">      console.log(<span class="string">'文章链接：'</span>+s.docurl);</div><div class="line">      console.log(<span class="string">'内容链接：'</span>+s.commenturl);</div><div class="line">      console.log(<span class="string">'tienum：'</span>+s.tienum);</div><div class="line">      console.log(<span class="string">'tlastid：'</span>+s.tlastid);</div><div class="line">      console.log(<span class="string">'tlink：'</span>+s.tlink);</div><div class="line">      console.log(<span class="string">'标签：'</span>+s.label);</div><div class="line">      console.log(<span class="string">'时间：'</span>+s.time);</div><div class="line">      console.log(<span class="string">'新闻类别：'</span>+s.newstype);</div><div class="line">      console.log(<span class="string">'频道名称：'</span>+s.channelname);</div><div class="line">      console.log(<span class="string">'图片链接：'</span>+s.imgurl);</div><div class="line">    &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h4 id="运行，大功告成，下次我们学习通过-pathomjs-来获取动态网页内容"><a href="#运行，大功告成，下次我们学习通过-pathomjs-来获取动态网页内容" class="headerlink" title="运行，大功告成，下次我们学习通过 pathomjs 来获取动态网页内容"></a>运行，大功告成，下次我们学习通过 pathomjs 来获取动态网页内容</h4><h5 id="再贴上几个地址，试试自己练习抓抓，自己也可以找一些其他网站练习，谢谢收看！"><a href="#再贴上几个地址，试试自己练习抓抓，自己也可以找一些其他网站练习，谢谢收看！" class="headerlink" title="再贴上几个地址，试试自己练习抓抓，自己也可以找一些其他网站练习，谢谢收看！"></a>再贴上几个地址，试试自己练习抓抓，自己也可以找一些其他网站练习，谢谢收看！</h5><h6 id="1-http-news-163-com-（网易新闻主页，可以练习分析网页的加载）"><a href="#1-http-news-163-com-（网易新闻主页，可以练习分析网页的加载）" class="headerlink" title="1.http://news.163.com/（网易新闻主页，可以练习分析网页的加载）"></a>1.<a href="http://news.163.com/（网易新闻主页，可以练习分析网页的加载）" target="_blank" rel="external">http://news.163.com/（网易新闻主页，可以练习分析网页的加载）</a></h6><h6 id="2-http-temp-163-com-special-00804KVA-cm-yaowen-js-callback-data-callback-（提取出来的请求，可以练习-Json-的处理以及中文网页转码）"><a href="#2-http-temp-163-com-special-00804KVA-cm-yaowen-js-callback-data-callback-（提取出来的请求，可以练习-Json-的处理以及中文网页转码）" class="headerlink" title="2.http://temp.163.com/special/00804KVA/cm_yaowen.js?callback=data_callback （提取出来的请求，可以练习 Json 的处理以及中文网页转码）"></a>2.<a href="http://temp.163.com/special/00804KVA/cm_yaowen.js?callback=data_callback" target="_blank" rel="external">http://temp.163.com/special/00804KVA/cm_yaowen.js?callback=data_callback</a> （提取出来的请求，可以练习 Json 的处理以及中文网页转码）</h6><h6 id="3-http-news-163-com-special-yaowen-channel-api-callback-channel-callback-amp-date-0120（就是前面那个再加上了时间戳，也用来练习-Json-处理以及中文网页转码）"><a href="#3-http-news-163-com-special-yaowen-channel-api-callback-channel-callback-amp-date-0120（就是前面那个再加上了时间戳，也用来练习-Json-处理以及中文网页转码）" class="headerlink" title="3.http://news.163.com/special/yaowen_channel_api/?callback=channel_callback&amp;date=0120（就是前面那个再加上了时间戳，也用来练习 Json 处理以及中文网页转码）"></a>3.<a href="http://news.163.com/special/yaowen_channel_api/?callback=channel_callback&amp;date=0120（就是前面那个再加上了时间戳，也用来练习" target="_blank" rel="external">http://news.163.com/special/yaowen_channel_api/?callback=channel_callback&amp;date=0120（就是前面那个再加上了时间戳，也用来练习</a> Json 处理以及中文网页转码）</h6><p><img src="http://on792ofrp.bkt.clouddn.com/17-3-23/35036394-file_1490278996843_1cd3.png" alt="image"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://WinterSmileSB101.online/2017/03/23/node-spider-first/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WinterSmileSB101">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WinterSmileSB101 的个人房间">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/23/node-spider-first/" itemprop="url">
                  一起学爬虫 Node.js 爬虫篇（一）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-23T14:16:38+08:00">
                2017-03-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/爬虫/" itemprop="url" rel="index">
                    <span itemprop="name">爬虫</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/爬虫/Node-js-爬虫/" itemprop="url" rel="index">
                    <span itemprop="name">Node.js 爬虫</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>版权声明：本文为 wintersmilesb101 -（个人独立博客– <a href="http://wintersmilesb101.online">http://wintersmilesb101.online</a> 欢迎访问）博主原创文章，未经博主允许不得转载。</p>
<p>一看到爬虫或者一百度爬虫，那是铺天盖地的全是 Python 爬虫啊，不得不说爬虫的框架与资料，Python 基本是最多的了，不过物极必反，Python 的爬虫有几点问题：<br>1.Python 对 DOM 支持貌似不是很好，网页的 DOM 处理不太好<br>2.Python 对网页编码的处理。<br>3.最重要的就是 Python 需要多线程。</p>
</blockquote>
<h4 id="以上问题我们现在即将使用的-Node-js-全部是优势！"><a href="#以上问题我们现在即将使用的-Node-js-全部是优势！" class="headerlink" title="以上问题我们现在即将使用的 Node.js 全部是优势！"></a>以上问题我们现在即将使用的 Node.js 全部是优势！</h4><h4 id="同样，Node-js-也有劣势，Node-js-是单线异步，这样很容易导致爬取请求发起顺序和结果返回顺序不一致，因此我们需要添加上请求序列号，处理完的再重新排序来实现结果与请求一致。还有，Node-js-毕竟是前端，数据的处理相较而言要差的多，但是作为网站数据爬取绝对够了。废话不多说，下面进入-Node-js-爬虫"><a href="#同样，Node-js-也有劣势，Node-js-是单线异步，这样很容易导致爬取请求发起顺序和结果返回顺序不一致，因此我们需要添加上请求序列号，处理完的再重新排序来实现结果与请求一致。还有，Node-js-毕竟是前端，数据的处理相较而言要差的多，但是作为网站数据爬取绝对够了。废话不多说，下面进入-Node-js-爬虫" class="headerlink" title="同样，Node.js 也有劣势，Node.js 是单线异步，这样很容易导致爬取请求发起顺序和结果返回顺序不一致，因此我们需要添加上请求序列号，处理完的再重新排序来实现结果与请求一致。还有，Node.js 毕竟是前端，数据的处理相较而言要差的多，但是作为网站数据爬取绝对够了。废话不多说，下面进入 Node.js 爬虫,"></a>同样，Node.js 也有劣势，Node.js 是单线异步，这样很容易导致爬取请求发起顺序和结果返回顺序不一致，因此我们需要添加上请求序列号，处理完的再重新排序来实现结果与请求一致。还有，Node.js 毕竟是前端，数据的处理相较而言要差的多，但是作为网站数据爬取绝对够了。废话不多说，下面进入 Node.js 爬虫,</h4><h4 id="Node-js-爬虫步骤"><a href="#Node-js-爬虫步骤" class="headerlink" title="Node.js 爬虫步骤"></a>Node.js 爬虫步骤</h4><h5 id="1-创建工程目录"><a href="#1-创建工程目录" class="headerlink" title="1.创建工程目录"></a><strong>1.创建工程目录</strong></h5><h6 id="这个随便你建立在什么地方，不过最好路径不要有中文，谁知道会不会出什么岔子。比如我们的工程路径为：-E-adt-bundle-windows-x86-64-20131030-Nodejs-nests-Dataget"><a href="#这个随便你建立在什么地方，不过最好路径不要有中文，谁知道会不会出什么岔子。比如我们的工程路径为：-E-adt-bundle-windows-x86-64-20131030-Nodejs-nests-Dataget" class="headerlink" title="这个随便你建立在什么地方，不过最好路径不要有中文，谁知道会不会出什么岔子。比如我们的工程路径为： E:\adt-bundle-windows-x86_64-20131030\Nodejs\nests_Dataget"></a>这个随便你建立在什么地方，不过最好路径不要有中文，谁知道会不会出什么岔子。比如我们的工程路径为： E:\adt-bundle-windows-x86_64-20131030\Nodejs\nests_Dataget</h6><h5 id="2-cmd-进入工程目录，初始化工程-命令依次如下"><a href="#2-cmd-进入工程目录，初始化工程-命令依次如下" class="headerlink" title="2.cmd 进入工程目录，初始化工程,命令依次如下"></a><strong>2.cmd 进入工程目录，初始化工程,命令依次如下</strong></h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function">E:</span></div><div class="line"><span class="title">cd</span> <span class="title">E</span>:\<span class="title">adt</span>-<span class="title">bundle</span>-<span class="title">windows</span>-<span class="title">x86_64</span>-20131030\<span class="title">Nodejs</span>\<span class="title">nests_Dataget</span></div><div class="line"><span class="title">npm</span> <span class="title">init</span></div></pre></td></tr></table></figure>
<h5 id="npm-init-是在当前目录创建模块（也就是生成-package-json）其文件属性说明如下"><a href="#npm-init-是在当前目录创建模块（也就是生成-package-json）其文件属性说明如下" class="headerlink" title="npm init 是在当前目录创建模块（也就是生成 package.json）其文件属性说明如下"></a>npm init 是在当前目录创建模块（也就是生成 package.json）其文件属性说明如下</h5><ul>
<li>name - 包名。</li>
<li>version - 包的版本号。</li>
<li>description - 包的描述。</li>
<li>homepage - 包的官网 url 。</li>
<li>author - 包的作者姓名。</li>
<li>contributors - 包的其他贡献者姓名。</li>
<li>dependencies - 依赖包列表。如果依赖包没有安装，npm 会自动将依赖包安装在 node_module 目录下。</li>
<li>repository - 包代码存放的地方的类型，可以是 git 或 svn，git 可在 Github 上。也就是你 Git 的仓库地址</li>
<li>main - main 字段是一个模块ID，它是一个指向你程序的主要项目。就是说，如果你包的名字叫 express，然后用户安装它，然后require(“express”)。</li>
<li>keywords - 关键字<h5 id="输入了-npm-init-之后会依次出现下面的询问"><a href="#输入了-npm-init-之后会依次出现下面的询问" class="headerlink" title="输入了 npm init 之后会依次出现下面的询问"></a>输入了 npm init 之后会依次出现下面的询问</h5></li>
</ul>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">$ npm init</div><div class="line">This utility will walk you through creating a package.json file.</div><div class="line">It only covers the most common items, and tries to guess sensible defaults.</div><div class="line"></div><div class="line">See `npm <span class="built_in">help</span> json` <span class="keyword">for</span> definitive documentation on these fields</div><div class="line">and exactly what they <span class="keyword">do</span>.</div><div class="line"></div><div class="line">Use `npm install &lt;pkg&gt; --save` afterwards to install a package and</div><div class="line">save it as a dependency <span class="keyword">in</span> the package.json file.</div><div class="line"></div><div class="line">Press ^C <span class="built_in">at</span> any <span class="built_in">time</span> to quit.</div><div class="line"><span class="function">name: (<span class="title">node_modules</span>) <span class="title">runoob</span>                   # 模块名</span></div><div class="line"><span class="title">version</span>: (1.0.0) #模块版本</div><div class="line"><span class="title">description</span>: <span class="title">Node.js</span> 测试模块(<span class="title">www.runoob.com</span>)  # 描述</div><div class="line"><span class="title">entry</span> <span class="title">point</span>: (<span class="title">index.js</span>)</div><div class="line"><span class="title">test</span> <span class="title">command</span>: <span class="title">make</span> <span class="title">test</span></div><div class="line"><span class="title">git</span> <span class="title">repository</span>: <span class="title">https</span>://<span class="title">github.com</span>/<span class="title">runoob</span>/<span class="title">runoob.git</span>  # <span class="title">Github</span> 地址</div><div class="line"><span class="title">keywords</span>: #关键字</div><div class="line"><span class="title">author</span>: #作者</div><div class="line"><span class="title">license</span>: (<span class="title">ISC</span>) #许可类型</div><div class="line"><span class="title">About</span> <span class="title">to</span> <span class="title">write</span> <span class="title">to</span> ……/<span class="title">node_modules</span>/<span class="title">package.json</span>:      # 生成地址</div><div class="line"></div><div class="line">&#123;</div><div class="line">  "<span class="title">name</span>": "<span class="title">runoob</span>",</div><div class="line">  "<span class="title">version</span>": "1.0.0",</div><div class="line">  "<span class="title">description</span>": "<span class="title">Node.js</span> 测试模块(<span class="title">www.runoob.com</span>)",</div><div class="line">  ……</div><div class="line">&#125;</div><div class="line"><span class="title">Is</span> <span class="title">this</span> <span class="title">ok</span>? (<span class="title">yes</span>) <span class="title">yes</span></div></pre></td></tr></table></figure>
<h5 id="上面的信息你可以根据自己的情况填写-填写有错误也不要紧，我们可以通过-package-json-随时修改。"><a href="#上面的信息你可以根据自己的情况填写-填写有错误也不要紧，我们可以通过-package-json-随时修改。" class="headerlink" title="上面的信息你可以根据自己的情况填写,填写有错误也不要紧，我们可以通过 package.json 随时修改。"></a>上面的信息你可以根据自己的情况填写,填写有错误也不要紧，我们可以通过 package.json 随时修改。</h5><h5 id="3-安装-request-和-cheerio-依赖"><a href="#3-安装-request-和-cheerio-依赖" class="headerlink" title="3.安装 request 和 cheerio 依赖"></a><strong>3.安装 request 和 cheerio 依赖</strong></h5><ul>
<li>request，跟python里request功能一样。它的功能就是建立起对目标网页的链接，并返回相应的数据。是我们做爬虫的重要一步，没有数据我们去哪里爬？</li>
<li>cheerio的功能是用来操作 dom 元素的，他可以把 request 返回来的数据转换成可供 dom 操作的数据，更重要的 cheerio 的 api 跟 jquery 一样，用$来选取对应的dom结点，这样就可以想取啥就取啥，感谢强大的 DOM<h5 id="安装命令如下"><a href="#安装命令如下" class="headerlink" title="安装命令如下"></a>安装命令如下</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">npm install request --save</div><div class="line">npm install cheerio</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="界面如下"><a href="#界面如下" class="headerlink" title="界面如下"></a>界面如下</h4><p><img src="http://on792ofrp.bkt.clouddn.com/17-3-23/51169339-file_1490253009287_7683.png" alt="image"></p>
<p><img src="http://on792ofrp.bkt.clouddn.com/17-3-23/3449173-file_1490253051949_ceb0.png" alt="image"></p>
<h4 id="4-接下来我们终于可以开始操作我们的-js-代码了"><a href="#4-接下来我们终于可以开始操作我们的-js-代码了" class="headerlink" title="4.接下来我们终于可以开始操作我们的 js 代码了"></a><strong>4.接下来我们终于可以开始操作我们的 js 代码了</strong></h4><h5 id="新建一个-js-文件，如果是主入口文件名称应该注意和-package-json-中-entry-point-一致。"><a href="#新建一个-js-文件，如果是主入口文件名称应该注意和-package-json-中-entry-point-一致。" class="headerlink" title="新建一个 js 文件，如果是主入口文件名称应该注意和 package.json 中 entry point 一致。"></a>新建一个 js 文件，如果是主入口文件名称应该注意和 package.json 中 entry point 一致。</h5><h5 id="这里我们新建一个-名为-server-js-的文件"><a href="#这里我们新建一个-名为-server-js-的文件" class="headerlink" title="这里我们新建一个 名为 server.js 的文件"></a>这里我们新建一个 名为 server.js 的文件</h5><h5 id="建立依赖引用，代码如下"><a href="#建立依赖引用，代码如下" class="headerlink" title="建立依赖引用，代码如下"></a>建立依赖引用，代码如下</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">var request = require(<span class="string">"request"</span>);</div><div class="line">var cheerio = require(<span class="string">"cheerio"</span>);</div></pre></td></tr></table></figure>
<h5 id="接下来我们就来爬爬百度首页链接为：https-www-baidu-com"><a href="#接下来我们就来爬爬百度首页链接为：https-www-baidu-com" class="headerlink" title="接下来我们就来爬爬百度首页链接为：https://www.baidu.com/"></a>接下来我们就来爬爬百度首页链接为：<a href="https://www.baidu.com/" target="_blank" rel="external">https://www.baidu.com/</a></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">request(<span class="string">'https://www.baidu.com/'</span>,function(err,result)&#123;</div><div class="line">    <span class="keyword">if</span>(err)&#123;</div><div class="line">        console.log(<span class="string">"错误："</span>+err);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    console.log(result.body);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h5 id="在-cmd-中输入-node-server-js-，回车，代码没有打错就会出现如下界面"><a href="#在-cmd-中输入-node-server-js-，回车，代码没有打错就会出现如下界面" class="headerlink" title="在 cmd 中输入 node server.js ，回车，代码没有打错就会出现如下界面"></a>在 cmd 中输入 node server.js ，回车，代码没有打错就会出现如下界面</h5><p><img src="http://on792ofrp.bkt.clouddn.com/17-3-23/25028822-file_1490253074161_fd0b.png" alt="image"></p>
<h5 id="可以看到我们已经获取到了网页的数据，漫漫长路我们已经走出了重要开头一步，只要能拿到完整的-Html-网页源码我们就好办了。"><a href="#可以看到我们已经获取到了网页的数据，漫漫长路我们已经走出了重要开头一步，只要能拿到完整的-Html-网页源码我们就好办了。" class="headerlink" title="可以看到我们已经获取到了网页的数据，漫漫长路我们已经走出了重要开头一步，只要能拿到完整的 Html 网页源码我们就好办了。"></a>可以看到我们已经获取到了网页的数据，漫漫长路我们已经走出了重要开头一步，只要能拿到完整的 Html 网页源码我们就好办了。</h5><h5 id="现在就是数据处理，前面我们不是还有个库没有用到吗？-没错就是-cheerio-库的使用"><a href="#现在就是数据处理，前面我们不是还有个库没有用到吗？-没错就是-cheerio-库的使用" class="headerlink" title="现在就是数据处理，前面我们不是还有个库没有用到吗？ 没错就是 cheerio 库的使用"></a>现在就是数据处理，前面我们不是还有个库没有用到吗？ 没错就是 cheerio 库的使用</h5><h5 id="现在我们来修改上面的代码，把成功获取到的网页交给-cheerio-处理-至于数据要怎么来通过-DOM-提取，我们这里通过-UC浏览器-访问-https-www-baidu-com-按下-F12-进入开发者模式依次对比看看我们要抓取的信息的位置，如这里我们要抓出百度的-title"><a href="#现在我们来修改上面的代码，把成功获取到的网页交给-cheerio-处理-至于数据要怎么来通过-DOM-提取，我们这里通过-UC浏览器-访问-https-www-baidu-com-按下-F12-进入开发者模式依次对比看看我们要抓取的信息的位置，如这里我们要抓出百度的-title" class="headerlink" title="现在我们来修改上面的代码，把成功获取到的网页交给 cheerio 处理,至于数据要怎么来通过 DOM 提取，我们这里通过 UC浏览器 访问 https://www.baidu.com/ 按下 F12 进入开发者模式依次对比看看我们要抓取的信息的位置，如这里我们要抓出百度的 title"></a>现在我们来修改上面的代码，把成功获取到的网页交给 cheerio 处理,至于数据要怎么来通过 DOM 提取，我们这里通过 UC浏览器 访问 <a href="https://www.baidu.com/" target="_blank" rel="external">https://www.baidu.com/</a> 按下 F12 进入开发者模式依次对比看看我们要抓取的信息的位置，如这里我们要抓出百度的 title</h5><p><img src="http://on792ofrp.bkt.clouddn.com/17-3-23/25327140-file_1490256714694_2dd2.png" alt="image"></p>
<h5 id="接下来就是编写抓取的-DOM-语句，不知道怎么使用的这里有-DOM-文档-，以及-JQuery-文档，我们这里要获取到标题的-DOM-就是-‘title’-text-于是代码改成如下："><a href="#接下来就是编写抓取的-DOM-语句，不知道怎么使用的这里有-DOM-文档-，以及-JQuery-文档，我们这里要获取到标题的-DOM-就是-‘title’-text-于是代码改成如下：" class="headerlink" title="接下来就是编写抓取的 DOM 语句，不知道怎么使用的这里有 DOM 文档 ，以及  JQuery 文档，我们这里要获取到标题的 DOM 就是 $(‘title’).text(),于是代码改成如下："></a>接下来就是编写抓取的 DOM 语句，不知道怎么使用的这里有 <a href="http://www.w3school.com.cn/htmldom/dom_properties.asp" target="_blank" rel="external">DOM 文档</a> ，以及 <a href="http://www.w3school.com.cn/jquery/jquery_ref_selectors.asp" target="_blank" rel="external"> JQuery 文档</a>，我们这里要获取到标题的 DOM 就是 $(‘title’).text(),于是代码改成如下：</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//把 html 装载到 cheerio 中</span></div><div class="line">	  var $ = cheerio.load(result.body);</div><div class="line">		<span class="comment">//通过 DOM 抓取网页数据</span></div><div class="line">		console.log($(<span class="string">'title'</span>).text());</div></pre></td></tr></table></figure>
<h5 id="效果："><a href="#效果：" class="headerlink" title="效果："></a>效果：</h5><p><img src="http://on792ofrp.bkt.clouddn.com/17-3-23/95571980-file_1490256919828_17e6a.png" alt="image"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://WinterSmileSB101.online/2017/03/22/图片资源从云存储器保存以及获取/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WinterSmileSB101">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WinterSmileSB101 的个人房间">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/22/图片资源从云存储器保存以及获取/" itemprop="url">
                  图片资源从云存储器保存以及获取
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-22T21:16:01+08:00">
                2017-03-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/博客/" itemprop="url" rel="index">
                    <span itemprop="name">博客</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>版权声明：本文为 wintersmilesb101 -（个人独立博客– <a href="http://wintersmilesb101.online">http://wintersmilesb101.online</a> 欢迎访问）博主原创文章，未经博主允许不得转载。</p>
</blockquote>
<h2 id="独立博客创建好了，最近又了解到七牛云储存-有免费-10-G-的存储空间，于是心中又起了坏水，为什么不把博客上的图片资源（图片资源是真的浪费空间）保存到七牛云储存上，然后通过外链引用图片资源，这么大的空间用来保存图片，够我们挥霍一段时间了。"><a href="#独立博客创建好了，最近又了解到七牛云储存-有免费-10-G-的存储空间，于是心中又起了坏水，为什么不把博客上的图片资源（图片资源是真的浪费空间）保存到七牛云储存上，然后通过外链引用图片资源，这么大的空间用来保存图片，够我们挥霍一段时间了。" class="headerlink" title="独立博客创建好了，最近又了解到七牛云储存,有免费 10 G 的存储空间，于是心中又起了坏水，为什么不把博客上的图片资源（图片资源是真的浪费空间）保存到七牛云储存上，然后通过外链引用图片资源，这么大的空间用来保存图片，够我们挥霍一段时间了。"></a>独立博客创建好了，最近又了解到<a href="http://www.qiniu.com/?utm_campaign=baiduSEM&amp;utm_source=baiduSEM&amp;utm_medium=baiduSEM&amp;utm_content=baiduSEM" target="_blank" rel="external">七牛云储存</a>,有免费 10 G 的存储空间，于是心中又起了坏水，为什么不把博客上的图片资源（图片资源是真的浪费空间）保存到七牛云储存上，然后通过外链引用图片资源，这么大的空间用来保存图片，够我们挥霍一段时间了。</h2><h2 id="如果你充值的话，是可以直接绑定域名的，那样更美滋滋，金额也不多就需要账户余额大于-10-元"><a href="#如果你充值的话，是可以直接绑定域名的，那样更美滋滋，金额也不多就需要账户余额大于-10-元" class="headerlink" title="如果你充值的话，是可以直接绑定域名的，那样更美滋滋，金额也不多就需要账户余额大于 10 元"></a>如果你充值的话，是可以直接绑定域名的，那样更美滋滋，金额也不多就需要账户余额大于 10 元</h2><h2 id="不充值也可以，毕竟免费的-10G-不是盖的"><a href="#不充值也可以，毕竟免费的-10G-不是盖的" class="headerlink" title="不充值也可以，毕竟免费的 10G 不是盖的"></a>不充值也可以，毕竟免费的 10G 不是盖的</h2><h2 id="下面介绍怎么通过-极简图床-与我们的七牛云空间联系起来并且上传图片"><a href="#下面介绍怎么通过-极简图床-与我们的七牛云空间联系起来并且上传图片" class="headerlink" title="下面介绍怎么通过 极简图床 与我们的七牛云空间联系起来并且上传图片"></a>下面介绍怎么通过 <a href="http://yotuku.cn/#/" target="_blank" rel="external">极简图床</a> 与我们的七牛云空间联系起来并且上传图片</h2><h3 id="1-注册七牛云并登陆，点击下方的按钮添加对象存储"><a href="#1-注册七牛云并登陆，点击下方的按钮添加对象存储" class="headerlink" title="1.注册七牛云并登陆，点击下方的按钮添加对象存储"></a>1.注册七牛云并登陆，点击下方的按钮添加对象存储</h3><p><img src="http://p1.bpimg.com/567571/30e9d6e83e4f4f27.png" alt="image"></p>
<h3 id="2-根据提示填写空间名称，存储区域，访问控制请选择公开访问"><a href="#2-根据提示填写空间名称，存储区域，访问控制请选择公开访问" class="headerlink" title="2.根据提示填写空间名称，存储区域，访问控制请选择公开访问"></a>2.根据提示填写空间名称，存储区域，访问控制请选择公开访问</h3><p><img src="http://p1.bqimg.com/567571/107c0b4a1317e2f4.png" alt="image"></p>
<h3 id="3-创建成功后进入该空间，获取该空间的测试域名，复制后备用"><a href="#3-创建成功后进入该空间，获取该空间的测试域名，复制后备用" class="headerlink" title="3.创建成功后进入该空间，获取该空间的测试域名，复制后备用"></a>3.创建成功后进入该空间，获取该空间的测试域名，复制后备用</h3><p><img src="http://p1.bqimg.com/567571/86b1181ab1e072fd.png" alt="image"></p>
<h3 id="4-点击“个人面板—密钥管理”，获取-AK-和-SK，复制后备用"><a href="#4-点击“个人面板—密钥管理”，获取-AK-和-SK，复制后备用" class="headerlink" title="4.点击“个人面板—密钥管理”，获取 AK 和 SK，复制后备用"></a>4.点击“个人面板—密钥管理”，获取 AK 和 SK，复制后备用</h3><p><img src="http://p1.bpimg.com/567571/4e98a9ab706ffc40.png" alt="image"></p>
<h3 id="5-打开极简图床，点击右上角设置按钮，将上面获得的“空间名称”、“AK”、“SK”，“域名”依次填写到下方的输入框中，点击保存。返回首页，再上传的图片就会默认上传至您的七牛云空间了。"><a href="#5-打开极简图床，点击右上角设置按钮，将上面获得的“空间名称”、“AK”、“SK”，“域名”依次填写到下方的输入框中，点击保存。返回首页，再上传的图片就会默认上传至您的七牛云空间了。" class="headerlink" title="5.打开极简图床，点击右上角设置按钮，将上面获得的“空间名称”、“AK”、“SK”，“域名”依次填写到下方的输入框中，点击保存。返回首页，再上传的图片就会默认上传至您的七牛云空间了。"></a>5.打开极简图床，点击右上角设置按钮，将上面获得的“空间名称”、“AK”、“SK”，“域名”依次填写到下方的输入框中，点击保存。返回首页，再上传的图片就会默认上传至您的七牛云空间了。</h3><p><img src="http://p1.bqimg.com/567571/c18cb7672bedcd97.png" alt="image"></p>
<h3 id="另外，极简图床也可以不使用外部云储存，不过限制比较厉害"><a href="#另外，极简图床也可以不使用外部云储存，不过限制比较厉害" class="headerlink" title="另外，极简图床也可以不使用外部云储存，不过限制比较厉害"></a>另外，极简图床也可以不使用外部云储存，不过限制比较厉害</h3><h3 id="使用公共空间时，如果您未注册登录，每天最多上传-10-张图片，登录后每天可上传-30-张图片，自定义七牛空间后将没有任何限制。"><a href="#使用公共空间时，如果您未注册登录，每天最多上传-10-张图片，登录后每天可上传-30-张图片，自定义七牛空间后将没有任何限制。" class="headerlink" title="使用公共空间时，如果您未注册登录，每天最多上传 10 张图片，登录后每天可上传 30 张图片，自定义七牛空间后将没有任何限制。"></a>使用公共空间时，如果您未注册登录，每天最多上传 10 张图片，登录后每天可上传 30 张图片，自定义七牛空间后将没有任何限制。</h3><h3 id="提供个小技巧，你可以在比如-CSDN-博客、简书、博客园等博客发布博客，然后再在私人博客发布，其中图片资源就使用那些博客的图片外链，"><a href="#提供个小技巧，你可以在比如-CSDN-博客、简书、博客园等博客发布博客，然后再在私人博客发布，其中图片资源就使用那些博客的图片外链，" class="headerlink" title="提供个小技巧，你可以在比如 CSDN 博客、简书、博客园等博客发布博客，然后再在私人博客发布，其中图片资源就使用那些博客的图片外链，"></a>提供个小技巧，你可以在比如 CSDN 博客、简书、博客园等博客发布博客，然后再在私人博客发布，其中图片资源就使用那些博客的图片外链，</h3><h3 id="这样也可以减少空间的消耗"><a href="#这样也可以减少空间的消耗" class="headerlink" title="这样也可以减少空间的消耗"></a>这样也可以减少空间的消耗</h3>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://WinterSmileSB101.online/2017/03/22/用AndroidSDK中的FaceDetector实现人脸识别/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WinterSmileSB101">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WinterSmileSB101 的个人房间">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/22/用AndroidSDK中的FaceDetector实现人脸识别/" itemprop="url">
                  用 AndroidSDK 中的 Face Detector 实现人脸识别
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-22T20:18:06+08:00">
                2017-03-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/SDK/" itemprop="url" rel="index">
                    <span itemprop="name">SDK</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>版权声明：本文为 wintersmilesb101 -（个人独立博客– <a href="http://wintersmilesb101.online">http://wintersmilesb101.online</a> 欢迎访问）博主转载文章，<a href="http://www.cnblogs.com/mainroadlee/p/android_sdk_face_detection.html" target="_blank" rel="external">原文地址</a>。</p>
</blockquote>
<h4 id="很多手机图片管理应用都开始集成人脸识别功能。一提到人脸识别，模式识别，滤波，BlahBlah-一堆复杂的技术名字戳入脑海中，立刻觉得这玩意儿没法碰，太玄乎了。其实Android-SDK从1-0版本中（API-level-1）就已经集成了简单的人脸识别功能，通过调用FaceDetector-我们可以在Android平台上实现Bitmap多人脸识别（一张图中有多个人脸出现的话）。周五啦，我就简简单单写写，希望感兴趣的同学对这个深藏在Android-SDK中的功能有所了解。"><a href="#很多手机图片管理应用都开始集成人脸识别功能。一提到人脸识别，模式识别，滤波，BlahBlah-一堆复杂的技术名字戳入脑海中，立刻觉得这玩意儿没法碰，太玄乎了。其实Android-SDK从1-0版本中（API-level-1）就已经集成了简单的人脸识别功能，通过调用FaceDetector-我们可以在Android平台上实现Bitmap多人脸识别（一张图中有多个人脸出现的话）。周五啦，我就简简单单写写，希望感兴趣的同学对这个深藏在Android-SDK中的功能有所了解。" class="headerlink" title="很多手机图片管理应用都开始集成人脸识别功能。一提到人脸识别，模式识别，滤波，BlahBlah 一堆复杂的技术名字戳入脑海中，立刻觉得这玩意儿没法碰，太玄乎了。其实Android SDK从1.0版本中（API level 1）就已经集成了简单的人脸识别功能，通过调用FaceDetector 我们可以在Android平台上实现Bitmap多人脸识别（一张图中有多个人脸出现的话）。周五啦，我就简简单单写写，希望感兴趣的同学对这个深藏在Android SDK中的功能有所了解。"></a>很多手机图片管理应用都开始集成人脸识别功能。一提到人脸识别，模式识别，滤波，BlahBlah 一堆复杂的技术名字戳入脑海中，立刻觉得这玩意儿没法碰，太玄乎了。其实Android SDK从1.0版本中（API level 1）就已经集成了简单的人脸识别功能，通过调用FaceDetector 我们可以在Android平台上实现Bitmap多人脸识别（一张图中有多个人脸出现的话）。周五啦，我就简简单单写写，希望感兴趣的同学对这个深藏在Android SDK中的功能有所了解。</h4><h4 id="流程是这样的："><a href="#流程是这样的：" class="headerlink" title="流程是这样的："></a>流程是这样的：</h4><h4 id="1-读取一张图片至Bitmap-（从Resource中，或是从手机相册中选取）"><a href="#1-读取一张图片至Bitmap-（从Resource中，或是从手机相册中选取）" class="headerlink" title="1. 读取一张图片至Bitmap （从Resource中，或是从手机相册中选取）"></a>1. 读取一张图片至Bitmap （从Resource中，或是从手机相册中选取）</h4><h4 id="2-使用FaceDetector-API分析Bitmap，将探测到的人脸数据以FaceDetector-Face存储在一个Face-list中；"><a href="#2-使用FaceDetector-API分析Bitmap，将探测到的人脸数据以FaceDetector-Face存储在一个Face-list中；" class="headerlink" title="2. 使用FaceDetector API分析Bitmap，将探测到的人脸数据以FaceDetector.Face存储在一个Face list中；"></a>2. 使用<a href="http://developer.android.com/reference/android/media/FaceDetector.html" target="_blank" rel="external">FaceDetector API</a>分析Bitmap，将探测到的人脸数据以FaceDetector.Face存储在一个Face list中；</h4><h4 id="3-将人脸框显示在图片上。"><a href="#3-将人脸框显示在图片上。" class="headerlink" title="3.将人脸框显示在图片上。"></a>3.将人脸框显示在图片上。</h4><h4 id="Step-1-读取图片"><a href="#Step-1-读取图片" class="headerlink" title="Step 1: 读取图片"></a>Step 1: 读取图片</h4><h4 id="从Drawable中读取图片资源"><a href="#从Drawable中读取图片资源" class="headerlink" title="从Drawable中读取图片资源"></a>从Drawable中读取图片资源</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Bitmap sampleBmp=BitmapFactory.decodeResource(getResources(), R.drawable.sample1);</div></pre></td></tr></table></figure>
<h4 id="或者直接从手机的图片库读取（Album-Gallery）"><a href="#或者直接从手机的图片库读取（Album-Gallery）" class="headerlink" title="或者直接从手机的图片库读取（Album/Gallery）"></a>或者直接从手机的图片库读取（Album/Gallery）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readPictureFromAlbum</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        Intent intent = <span class="keyword">new</span> Intent();</div><div class="line">        intent.setType(<span class="string">"image/*"</span>);</div><div class="line">        intent.setAction(Intent.ACTION_GET_CONTENT);</div><div class="line">        startActivityForResult(Intent.createChooser(intent,</div><div class="line">                <span class="string">"Select Picture"</span>), ALBUM_REQUEST_CODE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onActivityResult</span><span class="params">(<span class="keyword">int</span> requestCode,<span class="keyword">int</span> resultCode,Intent data)</span></span>&#123;</div><div class="line">        <span class="keyword">super</span>.onActivityResult(requestCode, resultCode, data);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (requestCode == ALBUM_REQUEST_CODE &amp;&amp; resultCode == RESULT_OK &amp;&amp; <span class="keyword">null</span> != data) &#123;</div><div class="line">            Uri selectedImage = data.getData();</div><div class="line">            String[] filePathColumn = &#123; MediaStore.Images.Media.DATA &#125;;</div><div class="line"></div><div class="line">            Cursor cursor = getContentResolver().query(selectedImage,</div><div class="line">                    filePathColumn, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</div><div class="line">            cursor.moveToFirst();</div><div class="line"></div><div class="line">            <span class="keyword">int</span> columnIndex = cursor.getColumnIndex(filePathColumn[<span class="number">0</span>]);</div><div class="line">            String picturePath = cursor.getString(columnIndex);</div><div class="line">            cursor.close();</div><div class="line">            Bitmap galleryBmp=BitmapFactory.decodeFile(picturePath);</div><div class="line">            <span class="comment">//placeholderFragment.detectFaces(galleryBmp);</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h4 id="当然，也可以直接从摄像头读取（Camera-Capture）。但我读摄像头返回图片的代码在模拟器上运行正常，而在三星的手机上Bug多多，后来看了下确实不少人遇到读取三星手机摄像头报错的问题。所以这段代码我就先不贴了。"><a href="#当然，也可以直接从摄像头读取（Camera-Capture）。但我读摄像头返回图片的代码在模拟器上运行正常，而在三星的手机上Bug多多，后来看了下确实不少人遇到读取三星手机摄像头报错的问题。所以这段代码我就先不贴了。" class="headerlink" title="当然，也可以直接从摄像头读取（Camera Capture）。但我读摄像头返回图片的代码在模拟器上运行正常，而在三星的手机上Bug多多，后来看了下确实不少人遇到读取三星手机摄像头报错的问题。所以这段代码我就先不贴了。"></a>当然，也可以直接从摄像头读取（Camera Capture）。但我读摄像头返回图片的代码在模拟器上运行正常，而在三星的手机上Bug多多，后来看了下确实不少人遇到读取三星手机摄像头报错的问题。所以这段代码我就先不贴了。</h4><h4 id="好了，我们拿到了Bitmap，识别起来！"><a href="#好了，我们拿到了Bitmap，识别起来！" class="headerlink" title="好了，我们拿到了Bitmap，识别起来！"></a>好了，我们拿到了Bitmap，识别起来！</h4><h4 id="Step-2-通过FaceDetector-API进行人脸识别"><a href="#Step-2-通过FaceDetector-API进行人脸识别" class="headerlink" title="Step 2: 通过FaceDetector API进行人脸识别"></a>Step 2: 通过FaceDetector API进行人脸识别</h4><h4 id="FaceDetecor只能读取RGB-565格式的Bitmap，所以在开始识别前，我们需要将上面得到的Bitmap进行一次格式转换。"><a href="#FaceDetecor只能读取RGB-565格式的Bitmap，所以在开始识别前，我们需要将上面得到的Bitmap进行一次格式转换。" class="headerlink" title="FaceDetecor只能读取RGB 565格式的Bitmap，所以在开始识别前，我们需要将上面得到的Bitmap进行一次格式转换。"></a>FaceDetecor只能读取RGB 565格式的Bitmap，所以在开始识别前，我们需要将上面得到的Bitmap进行一次格式转换。</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Bitmap tmpBmp = inputImage.copy(Bitmap.Config.RGB_565, <span class="keyword">true</span>);</div></pre></td></tr></table></figure>
<h4 id="图片格式没问题了，我们来创建一个FaceDetector的实例。FaceDetector是能从一张图中找出多个人脸的，可以通过设置MAX-FACES来控制搜索人脸的个数（我的程序里把MAX-FACES设成了1，只找出一个可信度最高的人脸）。"><a href="#图片格式没问题了，我们来创建一个FaceDetector的实例。FaceDetector是能从一张图中找出多个人脸的，可以通过设置MAX-FACES来控制搜索人脸的个数（我的程序里把MAX-FACES设成了1，只找出一个可信度最高的人脸）。" class="headerlink" title="图片格式没问题了，我们来创建一个FaceDetector的实例。FaceDetector是能从一张图中找出多个人脸的，可以通过设置MAX_FACES来控制搜索人脸的个数（我的程序里把MAX_FACES设成了1，只找出一个可信度最高的人脸）。"></a>图片格式没问题了，我们来创建一个FaceDetector的实例。FaceDetector是能从一张图中找出多个人脸的，可以通过设置MAX_FACES来控制搜索人脸的个数（我的程序里把MAX_FACES设成了1，只找出一个可信度最高的人脸）。</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">FaceDetector faceDet = <span class="keyword">new</span> FaceDetector(tmpBmp.getWidth(), tmpBmp.getHeight(), MAX_FACES);</div><div class="line">FaceDetector.Face[] faceList = <span class="keyword">new</span> FaceDetector.Face[MAX_FACES];</div><div class="line">faceDet.findFaces(tmpBmp, faceList);</div></pre></td></tr></table></figure>
<h4 id="通过调用FaceDetector-的findFaces方法，我们可以找到tmpBmp中的人脸数据，并存储在FaceDetector-Face-数组里（facelist）。"><a href="#通过调用FaceDetector-的findFaces方法，我们可以找到tmpBmp中的人脸数据，并存储在FaceDetector-Face-数组里（facelist）。" class="headerlink" title="通过调用FaceDetector 的findFaces方法，我们可以找到tmpBmp中的人脸数据，并存储在FaceDetector.Face 数组里（facelist）。"></a>通过调用FaceDetector 的findFaces方法，我们可以找到tmpBmp中的人脸数据，并存储在FaceDetector.Face 数组里（facelist）。</h4><h4 id="其实通过查看FaceDetector-API文档我们发现，它查找人脸的原理是：找眼睛。它返回的人脸数据face，通过调用public-float-eyesDistance-，public-void-getMidPoint-PointF-point-，我们可以得到探测到的两眼间距，以及两眼中心点位置（MidPoint）。public-float-confidence-可以返回该人脸数据的可信度-0-1-，这个值越大，该人脸数据的准确度也就越高。"><a href="#其实通过查看FaceDetector-API文档我们发现，它查找人脸的原理是：找眼睛。它返回的人脸数据face，通过调用public-float-eyesDistance-，public-void-getMidPoint-PointF-point-，我们可以得到探测到的两眼间距，以及两眼中心点位置（MidPoint）。public-float-confidence-可以返回该人脸数据的可信度-0-1-，这个值越大，该人脸数据的准确度也就越高。" class="headerlink" title="其实通过查看FaceDetector API文档我们发现，它查找人脸的原理是：找眼睛。它返回的人脸数据face，通过调用public float eyesDistance ()，public void getMidPoint (PointF point)，我们可以得到探测到的两眼间距，以及两眼中心点位置（MidPoint）。public float confidence () 可以返回该人脸数据的可信度(0~1)，这个值越大，该人脸数据的准确度也就越高。"></a>其实通过查看FaceDetector API文档我们发现，它查找人脸的原理是：找眼睛。它返回的人脸数据face，通过调用public float eyesDistance ()，public void getMidPoint (PointF point)，我们可以得到探测到的两眼间距，以及两眼中心点位置（MidPoint）。public float confidence () 可以返回该人脸数据的可信度(0~1)，这个值越大，该人脸数据的准确度也就越高。</h4><h4 id="通过读取保存在Face中的人脸数据，我们可以得到一个以两眼间距为边长，中心在两眼中点的一个正方形。"><a href="#通过读取保存在Face中的人脸数据，我们可以得到一个以两眼间距为边长，中心在两眼中点的一个正方形。" class="headerlink" title="通过读取保存在Face中的人脸数据，我们可以得到一个以两眼间距为边长，中心在两眼中点的一个正方形。"></a>通过读取保存在Face中的人脸数据，我们可以得到一个以两眼间距为边长，中心在两眼中点的一个正方形。</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; faceList.length; i++) &#123;</div><div class="line">                FaceDetector.Face face = faceList[i];</div><div class="line">                Log.d(<span class="string">"FaceDet"</span>, <span class="string">"Face ["</span>+face+<span class="string">"]"</span>);</div><div class="line">                <span class="keyword">if</span> (face != <span class="keyword">null</span>) &#123;</div><div class="line">                    Log.d(<span class="string">"FaceDet"</span>, <span class="string">"Face ["</span>+i+<span class="string">"] - Confidence ["</span>+face.confidence()+<span class="string">"]"</span>);</div><div class="line">                    PointF pf = <span class="keyword">new</span> PointF();</div><div class="line">                    <span class="comment">//getMidPoint(PointF point);</span></div><div class="line">                    <span class="comment">//Sets the position of the mid-point between the eyes.</span></div><div class="line">                    face.getMidPoint(pf);</div><div class="line">                    Log.d(<span class="string">"FaceDet"</span>, <span class="string">"\t Eyes distance ["</span>+face.eyesDistance()+<span class="string">"] - Face midpoint ["</span>+pf.x+<span class="string">"&amp;"</span>+pf.y+<span class="string">"]"</span>);</div><div class="line">                    RectF r = <span class="keyword">new</span> RectF();</div><div class="line">                    r.left = pf.x - face.eyesDistance() / <span class="number">2</span>;</div><div class="line">                    r.right = pf.x + face.eyesDistance() / <span class="number">2</span>;</div><div class="line">                    r.top = pf.y - face.eyesDistance() / <span class="number">2</span>;</div><div class="line">                    r.bottom = pf.y + face.eyesDistance() / <span class="number">2</span>;</div><div class="line">                    faceRects[i] = r;</div><div class="line">                    detectedFaces++;</div><div class="line">                &#125;</div><div class="line">            &#125;</div></pre></td></tr></table></figure>
<h4 id="有了这组RectF，把它显示在图片上，我们就大功告成了。"><a href="#有了这组RectF，把它显示在图片上，我们就大功告成了。" class="headerlink" title="有了这组RectF，把它显示在图片上，我们就大功告成了。"></a>有了这组RectF，把它显示在图片上，我们就大功告成了。</h4><h4 id="Step3-对原图进行缩放，并在图上显示人脸框。"><a href="#Step3-对原图进行缩放，并在图上显示人脸框。" class="headerlink" title="Step3:对原图进行缩放，并在图上显示人脸框。"></a>Step3:对原图进行缩放，并在图上显示人脸框。</h4><h4 id="自然，这里我们需要使用一个自定义的View。我把它命名为FaceView，每当FaceView人脸检测完成，如果检测到人脸，则invalidate一下（这样才能调用View-的-onDraw方法），然后在onDraw里，将人脸框显示出来。这里涉及到自定义View，以及图片，人脸框的按比例缩放。这里贴一下大概的代码，示例代码你可以在文末的链接里下载。"><a href="#自然，这里我们需要使用一个自定义的View。我把它命名为FaceView，每当FaceView人脸检测完成，如果检测到人脸，则invalidate一下（这样才能调用View-的-onDraw方法），然后在onDraw里，将人脸框显示出来。这里涉及到自定义View，以及图片，人脸框的按比例缩放。这里贴一下大概的代码，示例代码你可以在文末的链接里下载。" class="headerlink" title="自然，这里我们需要使用一个自定义的View。我把它命名为FaceView，每当FaceView人脸检测完成，如果检测到人脸，则invalidate一下（这样才能调用View 的 onDraw方法），然后在onDraw里，将人脸框显示出来。这里涉及到自定义View，以及图片，人脸框的按比例缩放。这里贴一下大概的代码，示例代码你可以在文末的链接里下载。"></a>自然，这里我们需要使用一个自定义的View。我把它命名为FaceView，每当FaceView人脸检测完成，如果检测到人脸，则invalidate一下（这样才能调用View 的 onDraw方法），然后在onDraw里，将人脸框显示出来。这里涉及到自定义View，以及图片，人脸框的按比例缩放。这里贴一下大概的代码，示例代码你可以在文末的链接里下载。</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">       <span class="keyword">super</span>.onDraw(canvas);</div><div class="line">       Paint imgPaint = <span class="keyword">new</span> Paint();</div><div class="line">       <span class="keyword">if</span>(inputImage!=<span class="keyword">null</span>)</div><div class="line">       &#123;</div><div class="line">           <span class="keyword">int</span> imgWidth=inputImage.getWidth();</div><div class="line">           <span class="keyword">int</span> imgHeight=inputImage.getHeight();</div><div class="line">           Rect src = <span class="keyword">new</span> Rect();<span class="comment">// 图片</span></div><div class="line">           src.top=<span class="number">0</span>;</div><div class="line">           src.left=<span class="number">0</span>;</div><div class="line">           src.right=src.left+imgWidth;</div><div class="line">           src.bottom=src.top+imgHeight;</div><div class="line">           Rect dst = <span class="keyword">new</span> Rect();<span class="comment">// 屏幕</span></div><div class="line">           <span class="keyword">int</span> viewWidth=<span class="keyword">this</span>.getWidth();</div><div class="line">           <span class="keyword">int</span> width=<span class="number">0</span>;</div><div class="line">           <span class="keyword">int</span> height=<span class="number">0</span>;</div><div class="line">           <span class="keyword">if</span>(inputImage.getWidth()&gt;viewWidth)</div><div class="line">           &#123;</div><div class="line">               width=viewWidth;</div><div class="line">               height=(viewWidth*imgHeight)/imgWidth;</div><div class="line">           &#125;</div><div class="line">           <span class="keyword">else</span></div><div class="line">           &#123;</div><div class="line">               width=imgWidth;</div><div class="line">               height=imgHeight;</div><div class="line">           &#125;</div><div class="line">           dst.top=<span class="number">0</span>;</div><div class="line">           dst.left=<span class="number">0</span>;</div><div class="line">           dst.right=dst.left+width;</div><div class="line">           dst.bottom=dst.top+height;</div><div class="line"></div><div class="line">           canvas.drawBitmap(inputImage, src, dst, imgPaint);</div><div class="line">           Log.v(<span class="string">"FaceView"</span>,<span class="string">"view width:"</span>+<span class="keyword">this</span>.getWidth());</div><div class="line"></div><div class="line">           <span class="keyword">if</span>(detected)</div><div class="line">           &#123;</div><div class="line">               Paint rectPaint = <span class="keyword">new</span> Paint();</div><div class="line">               rectPaint.setStrokeWidth(<span class="number">2</span>);</div><div class="line">               rectPaint.setColor(Color.RED);</div><div class="line">               rectPaint.setStyle(Paint.Style.STROKE);</div><div class="line"></div><div class="line">               <span class="comment">//float scaleRatio=((float)width)/(float)imgWidth;</span></div><div class="line"></div><div class="line">               <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; detectedFaces; i++) &#123;</div><div class="line">                   RectF r = faceRects[i];</div><div class="line">                   Log.v(<span class="string">"FaceView"</span>,<span class="string">"r.top="</span>+r.top);</div><div class="line">                   r.top=(r.top*width)/imgWidth;</div><div class="line">                   r.left=(r.left*width)/imgWidth;</div><div class="line">                   r.right=(r.right*width)/imgWidth;</div><div class="line">                   r.bottom=(r.bottom*width)/imgWidth;</div><div class="line"></div><div class="line">                   <span class="keyword">if</span> (r != <span class="keyword">null</span>)</div><div class="line">                       canvas.drawRect(r, rectPaint);</div><div class="line">               &#125;</div><div class="line">               detected=<span class="keyword">false</span>;</div><div class="line">               detectedFaces=<span class="number">0</span>;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<h4 id="注意：FaceDetector搜索人脸的过程是比较耗时的，尤其当图片Size较大（例如640-480）时，耗时个一两秒是很常见的。为防止程序长时间没相应报错，人脸检测部分我使用了AsyncTask"><a href="#注意：FaceDetector搜索人脸的过程是比较耗时的，尤其当图片Size较大（例如640-480）时，耗时个一两秒是很常见的。为防止程序长时间没相应报错，人脸检测部分我使用了AsyncTask" class="headerlink" title="注意：FaceDetector搜索人脸的过程是比较耗时的，尤其当图片Size较大（例如640*480）时，耗时个一两秒是很常见的。为防止程序长时间没相应报错，人脸检测部分我使用了AsyncTask"></a>注意：FaceDetector搜索人脸的过程是比较耗时的，尤其当图片Size较大（例如640*480）时，耗时个一两秒是很常见的。为防止程序长时间没相应报错，人脸检测部分我使用了AsyncTask</h4><h4 id="运行结果："><a href="#运行结果：" class="headerlink" title="运行结果："></a>运行结果：</h4><h4 id="p-s-感谢下-公下-エリカ-清纯的图片ㅋㅋㅋ"><a href="#p-s-感谢下-公下-エリカ-清纯的图片ㅋㅋㅋ" class="headerlink" title="p.s 感谢下 公下 エリカ 清纯的图片ㅋㅋㅋ"></a>p.s 感谢下 公下 エリカ 清纯的图片ㅋㅋㅋ</h4><h4 id="注意：FaceDetector做些简单的人脸识别还可以，要是需要专业，快速，甚至和数据库比对匹配的那种高级人脸识别算法，可以试试OpenCV的Android开发包-http-opencv-org-platforms-android-html"><a href="#注意：FaceDetector做些简单的人脸识别还可以，要是需要专业，快速，甚至和数据库比对匹配的那种高级人脸识别算法，可以试试OpenCV的Android开发包-http-opencv-org-platforms-android-html" class="headerlink" title="注意：FaceDetector做些简单的人脸识别还可以，要是需要专业，快速，甚至和数据库比对匹配的那种高级人脸识别算法，可以试试OpenCV的Android开发包 http://opencv.org/platforms/android.html"></a>注意：FaceDetector做些简单的人脸识别还可以，要是需要专业，快速，甚至和数据库比对匹配的那种高级人脸识别算法，可以试试OpenCV的Android开发包 <a href="http://opencv.org/platforms/android.html" target="_blank" rel="external">http://opencv.org/platforms/android.html</a></h4><h4 id="Sample代码下载："><a href="#Sample代码下载：" class="headerlink" title="Sample代码下载："></a>Sample代码下载：</h4><h4 id="https-www-dropbox-com-s-3vz252c9olipnjv-FaceDetectionTutorialProject-zip"><a href="#https-www-dropbox-com-s-3vz252c9olipnjv-FaceDetectionTutorialProject-zip" class="headerlink" title="https://www.dropbox.com/s/3vz252c9olipnjv/FaceDetectionTutorialProject.zip"></a><a href="https://www.dropbox.com/s/3vz252c9olipnjv/FaceDetectionTutorialProject.zip" target="_blank" rel="external">https://www.dropbox.com/s/3vz252c9olipnjv/FaceDetectionTutorialProject.zip</a></h4><h4 id="http-www-mobiletuts-me-一个及时更新的Android开发教程网站"><a href="#http-www-mobiletuts-me-一个及时更新的Android开发教程网站" class="headerlink" title="http://www.mobiletuts.me 一个及时更新的Android开发教程网站"></a><a href="http://www.mobiletuts.me" target="_blank" rel="external">http://www.mobiletuts.me</a> 一个及时更新的Android开发教程网站</h4><h4 id="再次说下，由于原图挂了，最近又比较忙，还没能及时补图，还有现在也有很多成熟的脸部检测方案了，比如免费的脸型检测SDK网站Face-需要进阶功能的童靴可以自行登录face-com去建立更加专业的脸型检测。"><a href="#再次说下，由于原图挂了，最近又比较忙，还没能及时补图，还有现在也有很多成熟的脸部检测方案了，比如免费的脸型检测SDK网站Face-需要进阶功能的童靴可以自行登录face-com去建立更加专业的脸型检测。" class="headerlink" title="再次说下，由于原图挂了，最近又比较忙，还没能及时补图，还有现在也有很多成熟的脸部检测方案了，比如免费的脸型检测SDK网站Face++,需要进阶功能的童靴可以自行登录face++.com去建立更加专业的脸型检测。"></a>再次说下，由于原图挂了，最近又比较忙，还没能及时补图，还有现在也有很多成熟的脸部检测方案了，比如免费的脸型检测SDK网站Face++,需要进阶功能的童靴可以自行登录face++.com去建立更加专业的脸型检测。</h4>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://WinterSmileSB101.online/2017/03/22/安卓实现网易云音乐底部播放栏效果之使用自定义BaseActivity实现上/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WinterSmileSB101">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WinterSmileSB101 的个人房间">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/22/安卓实现网易云音乐底部播放栏效果之使用自定义BaseActivity实现上/" itemprop="url">
                  安卓实现网易云音乐底部播放栏效果之使用自定义BaseActivity实现上
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-22T20:17:19+08:00">
                2017-03-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/Android-实战/" itemprop="url" rel="index">
                    <span itemprop="name">Android 实战</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/Android-实战/Android-馨乐（音乐APP，UI仿网易云音乐）开发/" itemprop="url" rel="index">
                    <span itemprop="name">Android 馨乐（音乐APP，UI仿网易云音乐）开发</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>版权声明：本文为 wintersmilesb101 -（个人独立博客– <a href="http://wintersmilesb101.online">http://wintersmilesb101.online</a> 欢迎访问）博主原创文章，未经博主允许不得转载。</p>
<p><a href="https://github.com/WinterSmileSB101/winterMusic" target="_blank" rel="external">项目 GitHub 地址</a><br><a href="http://download.csdn.net/detail/qq_21265915/9661736" target="_blank" rel="external">此博文源码下载地址</a></p>
</blockquote>
<h4 id="起因：-最近在写一个音乐项目，发现网易云音乐的底部播放栏看起来不错，不同的页面切换也能做到无缝连接，于是自己打算仿造一个。"><a href="#起因：-最近在写一个音乐项目，发现网易云音乐的底部播放栏看起来不错，不同的页面切换也能做到无缝连接，于是自己打算仿造一个。" class="headerlink" title="起因： 最近在写一个音乐项目，发现网易云音乐的底部播放栏看起来不错，不同的页面切换也能做到无缝连接，于是自己打算仿造一个。"></a>起因： 最近在写一个音乐项目，发现网易云音乐的底部播放栏看起来不错，不同的页面切换也能做到无缝连接，于是自己打算仿造一个。</h4><h4 id="折磨：-1-一开始我看到知乎有大神说使用Activity-Fragment实现的，链接，但是我的项目已经使用了多Activity布局，直接推翻不太舒服，也太懒，也麻烦。于是这个方法废除。"><a href="#折磨：-1-一开始我看到知乎有大神说使用Activity-Fragment实现的，链接，但是我的项目已经使用了多Activity布局，直接推翻不太舒服，也太懒，也麻烦。于是这个方法废除。" class="headerlink" title="折磨： 1.一开始我看到知乎有大神说使用Activity+Fragment实现的，链接，但是我的项目已经使用了多Activity布局，直接推翻不太舒服，也太懒，也麻烦。于是这个方法废除。"></a>折磨： 1.一开始我看到知乎有大神说使用Activity+Fragment实现的，<a href="http://www.zhihu.com/question/36448929" target="_blank" rel="external">链接</a>，但是我的项目已经使用了多Activity布局，直接推翻不太舒服，也太懒，也麻烦。于是这个方法废除。</h4><h4 id="2-后来又了解到应该可以直接自定义一个BaseActivity，在其中的onPost-（）方法里实现布局的添加，方法参数我就不写了，然后重写startActivity（Intent-intent）方法，在里面设置intent的-flag-为Intent-FLAG-ACTIVITY-NO-ANIMATION，即为取消切换Activity的时候的动画效果，这样就能实现无缝切换了。这样看来应该可行。我并没有实验过，有兴趣的童鞋可以自己实验一次。"><a href="#2-后来又了解到应该可以直接自定义一个BaseActivity，在其中的onPost-（）方法里实现布局的添加，方法参数我就不写了，然后重写startActivity（Intent-intent）方法，在里面设置intent的-flag-为Intent-FLAG-ACTIVITY-NO-ANIMATION，即为取消切换Activity的时候的动画效果，这样就能实现无缝切换了。这样看来应该可行。我并没有实验过，有兴趣的童鞋可以自己实验一次。" class="headerlink" title="2.后来又了解到应该可以直接自定义一个BaseActivity，在其中的onPost （）方法里实现布局的添加，方法参数我就不写了，然后重写startActivity（Intent intent）方法，在里面设置intent的 flag 为Intent.FLAG_ACTIVITY_NO_ANIMATION，即为取消切换Activity的时候的动画效果，这样就能实现无缝切换了。这样看来应该可行。我并没有实验过，有兴趣的童鞋可以自己实验一次。"></a>2.后来又了解到应该可以直接自定义一个BaseActivity，在其中的onPost （）方法里实现布局的添加，方法参数我就不写了，然后重写startActivity（Intent intent）方法，在里面设置intent的 flag 为Intent.FLAG_ACTIVITY_NO_ANIMATION，即为取消切换Activity的时候的动画效果，这样就能实现无缝切换了。这样看来应该可行。我并没有实验过，有兴趣的童鞋可以自己实验一次。</h4><h4 id="3-这一次，也是在知乎看到一个大神给出的思路，这个思路看起来前两个简单，而且更容易维护代码，自定义性也更好，那就是使用悬浮窗！不过使用这个也有问题，就是权限的问题，很多手机都是默认禁止掉了应用程序的悬浮窗权限，但是如果你开发的是系统应用的话，就默认给予了，不过我相信大多数人开发的都不是系统应用，所以这就是个麻烦点。为了解决这个，我们需要把WindowManager-LayoutParams-的变量的type设置为TYPE-TOAST-具体对应实际使用可以看这篇博客，具体我没有试验过，不过通过TYPE-TOAST这种类型设置，无权限显示是实现了，但是现在即使你不在引用程序内，只要程序没有退出，他都会一直显示在屏幕上，这显然不符合我们的要求，对于这个问题，有一种解决办法是对程序进行后台检测，但是这种方法太消耗性能，一，用固定时间刷新会导致用户体验差，如果时间差够短，用户体验没什么，但是性能被大幅度浪费了。所以这种方法不行。"><a href="#3-这一次，也是在知乎看到一个大神给出的思路，这个思路看起来前两个简单，而且更容易维护代码，自定义性也更好，那就是使用悬浮窗！不过使用这个也有问题，就是权限的问题，很多手机都是默认禁止掉了应用程序的悬浮窗权限，但是如果你开发的是系统应用的话，就默认给予了，不过我相信大多数人开发的都不是系统应用，所以这就是个麻烦点。为了解决这个，我们需要把WindowManager-LayoutParams-的变量的type设置为TYPE-TOAST-具体对应实际使用可以看这篇博客，具体我没有试验过，不过通过TYPE-TOAST这种类型设置，无权限显示是实现了，但是现在即使你不在引用程序内，只要程序没有退出，他都会一直显示在屏幕上，这显然不符合我们的要求，对于这个问题，有一种解决办法是对程序进行后台检测，但是这种方法太消耗性能，一，用固定时间刷新会导致用户体验差，如果时间差够短，用户体验没什么，但是性能被大幅度浪费了。所以这种方法不行。" class="headerlink" title="3.这一次，也是在知乎看到一个大神给出的思路，这个思路看起来前两个简单，而且更容易维护代码，自定义性也更好，那就是使用悬浮窗！不过使用这个也有问题，就是权限的问题，很多手机都是默认禁止掉了应用程序的悬浮窗权限，但是如果你开发的是系统应用的话，就默认给予了，不过我相信大多数人开发的都不是系统应用，所以这就是个麻烦点。为了解决这个，我们需要把WindowManager.LayoutParams 的变量的type设置为TYPE_TOAST,具体对应实际使用可以看这篇博客，具体我没有试验过，不过通过TYPE_TOAST这种类型设置，无权限显示是实现了，但是现在即使你不在引用程序内，只要程序没有退出，他都会一直显示在屏幕上，这显然不符合我们的要求，对于这个问题，有一种解决办法是对程序进行后台检测，但是这种方法太消耗性能，一，用固定时间刷新会导致用户体验差，如果时间差够短，用户体验没什么，但是性能被大幅度浪费了。所以这种方法不行。"></a>3.这一次，也是在知乎看到一个大神给出的思路，这个思路看起来前两个简单，而且更容易维护代码，自定义性也更好，那就是使用悬浮窗！不过使用这个也有问题，就是权限的问题，很多手机都是默认禁止掉了应用程序的悬浮窗权限，但是如果你开发的是系统应用的话，就默认给予了，不过我相信大多数人开发的都不是系统应用，所以这就是个麻烦点。为了解决这个，我们需要把WindowManager.LayoutParams 的变量的type设置为TYPE_TOAST,具体对应实际使用可以看<a href="http://blog.csdn.net/qq_28690547/article/details/50386045" target="_blank" rel="external">这篇博客</a>，具体我没有试验过，不过通过TYPE_TOAST这种类型设置，无权限显示是实现了，但是现在即使你不在引用程序内，只要程序没有退出，他都会一直显示在屏幕上，这显然不符合我们的要求，对于这个问题，有一种解决办法是对程序进行后台检测，但是这种方法太消耗性能，一，用固定时间刷新会导致用户体验差，如果时间差够短，用户体验没什么，但是性能被大幅度浪费了。所以这种方法不行。</h4><h3 id="结果：难道就没有只在程序内显示的无需权限的悬浮窗了吗？答案大家一起寻找吧。在这里我使用第二种方法，"><a href="#结果：难道就没有只在程序内显示的无需权限的悬浮窗了吗？答案大家一起寻找吧。在这里我使用第二种方法，" class="headerlink" title="结果：难道就没有只在程序内显示的无需权限的悬浮窗了吗？答案大家一起寻找吧。在这里我使用第二种方法，"></a>结果：难道就没有只在程序内显示的无需权限的悬浮窗了吗？答案大家一起寻找吧。在这里我使用第二种方法，</h3><h3 id="步骤：1-定义BaseActivity，继承自AppCompatActivity"><a href="#步骤：1-定义BaseActivity，继承自AppCompatActivity" class="headerlink" title="步骤：1.定义BaseActivity，继承自AppCompatActivity"></a>步骤：1.定义BaseActivity，继承自AppCompatActivity</h3><h3 id="直接上代码，注释里我写了关键位置，其他很简单"><a href="#直接上代码，注释里我写了关键位置，其他很简单" class="headerlink" title="直接上代码，注释里我写了关键位置，其他很简单"></a>直接上代码，注释里我写了关键位置，其他很简单</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> winter.zxb.smilesb101.winterMusic;  </div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Intent;  </div><div class="line"><span class="keyword">import</span> android.os.Bundle;  </div><div class="line"><span class="keyword">import</span> android.support.annotation.Nullable;  </div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;  </div><div class="line"><span class="keyword">import</span> android.view.Gravity;  </div><div class="line"><span class="keyword">import</span> android.view.LayoutInflater;  </div><div class="line"><span class="keyword">import</span> android.view.View;  </div><div class="line"><span class="keyword">import</span> android.view.ViewGroup;  </div><div class="line"><span class="keyword">import</span> android.view.WindowManager;  </div><div class="line"><span class="keyword">import</span> android.widget.FrameLayout;  </div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 自定义基类，实现无缝切换底部播放栏</div><div class="line"> * Created by SmileSB101 on 2016/10/19 0019.</div><div class="line"> */  </div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseActity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span></span>&#123;  </div><div class="line">    <span class="comment">/**</span></div><div class="line">     * windowManager对象</div><div class="line">     */  </div><div class="line">    <span class="keyword">private</span> WindowManager windowManager;  </div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 根视野</div><div class="line">     */  </div><div class="line">    <span class="keyword">private</span> FrameLayout mContentContainer;  </div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 浮动视野</div><div class="line">     */  </div><div class="line">    <span class="keyword">private</span> View mFloatView;  </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span></span>&#123;  </div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);  </div><div class="line">        ViewGroup mDecorView = (ViewGroup) getWindow().getDecorView();  </div><div class="line">        mContentContainer = (FrameLayout) ((ViewGroup) mDecorView.getChildAt(<span class="number">0</span>)).getChildAt(<span class="number">1</span>);  </div><div class="line">        mFloatView =  LayoutInflater.from(getBaseContext()).inflate(R.layout.float_music_control_layout, <span class="keyword">null</span>);  </div><div class="line">    &#125;  </div><div class="line"></div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPostCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span></span>&#123;  </div><div class="line">        <span class="keyword">super</span>.onPostCreate(savedInstanceState);  </div><div class="line">        FrameLayout.LayoutParams layoutParams = <span class="keyword">new</span> FrameLayout.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT,ViewGroup.LayoutParams.WRAP_CONTENT);  </div><div class="line">        layoutParams.gravity = Gravity.BOTTOM;  </div><div class="line">        mContentContainer.addView(mFloatView,layoutParams);  </div><div class="line">    &#125;  </div><div class="line"></div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">()</span></span>&#123;  </div><div class="line">        <span class="keyword">super</span>.onStart();  </div><div class="line">    &#125;  </div><div class="line"></div><div class="line">    <span class="comment">/***</span></div><div class="line">     * 重点，设置这个可以实现前进Activity时候的无动画切换</div><div class="line">     * <span class="doctag">@param</span> intent</div><div class="line">     */  </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startActivity</span><span class="params">(Intent intent)</span></span>&#123;  </div><div class="line">        intent.setFlags(Intent.FLAG_ACTIVITY_NO_ANIMATION);<span class="comment">//设置切换没有动画，用来实现活动之间的无缝切换  </span></div><div class="line">        <span class="keyword">super</span>.startActivity(intent);  </div><div class="line">    &#125;  </div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     *  重点，在这里设置按下返回键，或者返回button的时候无动画</div><div class="line">     */  </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">finish</span><span class="params">()</span></span>&#123;  </div><div class="line">        <span class="keyword">super</span>.finish();  </div><div class="line">        overridePendingTransition(<span class="number">0</span>, <span class="number">0</span>);<span class="comment">//设置返回没有动画  </span></div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="2-其他需要播放栏的类继承自这个自定义的Activity就可以实现效果了。"><a href="#2-其他需要播放栏的类继承自这个自定义的Activity就可以实现效果了。" class="headerlink" title="2.其他需要播放栏的类继承自这个自定义的Activity就可以实现效果了。"></a>2.其他需要播放栏的类继承自这个自定义的Activity就可以实现效果了。</h3><p><img src="http://img.blog.csdn.net/20161019133617996?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="image"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://WinterSmileSB101.online/2017/03/22/Serivce通知Activity更新UI方法总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WinterSmileSB101">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WinterSmileSB101 的个人房间">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/22/Serivce通知Activity更新UI方法总结/" itemprop="url">
                  Serivce通知Activity更新UI方法总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-22T17:47:27+08:00">
                2017-03-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>版权声明：本文为 wintersmilesb101 -（个人独立博客– <a href="http://wintersmilesb101.online">http://wintersmilesb101.online</a> 欢迎访问）博主转载文章，<a href="http://blog.163.com/ppy2790@126/blog/static/1032422412013112542544572/" target="_blank" rel="external">原文地址</a>。</p>
</blockquote>
<h4 id="Activity与Service是Android的两个重要组件，在使用过程中我们遇到最多的是他们之间通讯的问题。"><a href="#Activity与Service是Android的两个重要组件，在使用过程中我们遇到最多的是他们之间通讯的问题。" class="headerlink" title="Activity与Service是Android的两个重要组件，在使用过程中我们遇到最多的是他们之间通讯的问题。"></a>Activity与Service是Android的两个重要组件，在使用过程中我们遇到最多的是他们之间通讯的问题。</h4><h4 id="1、Activity向Service传递消息的方法："><a href="#1、Activity向Service传递消息的方法：" class="headerlink" title="1、Activity向Service传递消息的方法："></a>1、Activity向Service传递消息的方法：</h4><pre><code>1）利用BroadcastReceiver发送广播，Activity发送广播，Service中定义广播接收者进行接收。
2）利用绑定服务的方式开启服务，暴露服务中的方法，Activity进行调用。
3）利用Intent打开服务(开启服务)的方式，通过Intent传递数据。
</code></pre><h4 id="2、Service向Activity传递消息的方法："><a href="#2、Service向Activity传递消息的方法：" class="headerlink" title="2、Service向Activity传递消息的方法："></a>2、Service向Activity传递消息的方法：</h4><pre><code>1）利用BroadcastReceiver，在Service中发送广播，Activity中接收。
2）利用Handler在Service中发送消息，Activity中handleMessage进行处理。
</code></pre><h4 id="下面以音乐播放器案例来，对以上的方式进行示例说明。"><a href="#下面以音乐播放器案例来，对以上的方式进行示例说明。" class="headerlink" title="下面以音乐播放器案例来，对以上的方式进行示例说明。"></a>下面以音乐播放器案例来，对以上的方式进行示例说明。</h4><h4 id="在这个案例中，Activity界面按钮-播放、暂停、停止-要发送消息给Service-负责音乐播放-，Service要把播放进度通知给Activity进行播放进度的更新。"><a href="#在这个案例中，Activity界面按钮-播放、暂停、停止-要发送消息给Service-负责音乐播放-，Service要把播放进度通知给Activity进行播放进度的更新。" class="headerlink" title="在这个案例中，Activity界面按钮(播放、暂停、停止)要发送消息给Service(负责音乐播放)，Service要把播放进度通知给Activity进行播放进度的更新。"></a>在这个案例中，Activity界面按钮(播放、暂停、停止)要发送消息给Service(负责音乐播放)，Service要把播放进度通知给Activity进行播放进度的更新。</h4><h4 id="程序的界面很简单-原文图片挂了，所以节哀顺变，各位看官自行脑补吧-："><a href="#程序的界面很简单-原文图片挂了，所以节哀顺变，各位看官自行脑补吧-：" class="headerlink" title="程序的界面很简单(原文图片挂了，所以节哀顺变，各位看官自行脑补吧)："></a>程序的界面很简单(原文图片挂了，所以节哀顺变，各位看官自行脑补吧)：</h4><h4 id="一、BroadcastReceiver实现Activity与Service相互通讯："><a href="#一、BroadcastReceiver实现Activity与Service相互通讯：" class="headerlink" title="一、BroadcastReceiver实现Activity与Service相互通讯："></a>一、BroadcastReceiver实现Activity与Service相互通讯：</h4><h4 id="Activity中："><a href="#Activity中：" class="headerlink" title="Activity中："></a>Activity中：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//点击播放、暂停按钮</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">Intent intent = <span class="keyword">new</span> Intent();</div><div class="line">intent.putExtra(<span class="string">"ctrl"</span>, <span class="number">1</span>);</div><div class="line">intent.setAction(<span class="string">"org.itair.service.receiver"</span>);</div><div class="line">sendBroadcast(intent);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//点击停止按钮</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">Intent intent = <span class="keyword">new</span> Intent();</div><div class="line">intent.putExtra(<span class="string">"ctrl"</span>, <span class="number">3</span>);</div><div class="line">intent.setAction(<span class="string">"org.itair.service.receiver"</span>);</div><div class="line">sendBroadcast(intent);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Service中动态注册一个广播接收者："><a href="#Service中动态注册一个广播接收者：" class="headerlink" title="Service中动态注册一个广播接收者："></a>Service中动态注册一个广播接收者：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">ServiceRecevier serviceRecevier = <span class="keyword">new</span> ServiceRecevier();</div><div class="line">IntentFilter intentFilter = <span class="keyword">new</span> IntentFilter();</div><div class="line">intentFilter.addAction(<span class="string">"org.itair.service.receiver"</span>);</div><div class="line">registerReceiver(serviceRecevier, intentFilter);</div><div class="line"></div><div class="line">Service中的BroadcastReceiver，收到后，同时也向Activity发送广播，（同样在Activity中也需要注册广播接收者）</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceRecevier</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</div><div class="line"><span class="comment">// 接收到Activity播放消息类型后，进行判断，调用服务中播放，暂停，停止的方法</span></div><div class="line"><span class="keyword">int</span> ctrl = intent.getExtras().getInt(<span class="string">"ctrl"</span>, -<span class="number">1</span>);</div><div class="line"><span class="keyword">int</span> type = -<span class="number">1</span>;</div><div class="line"><span class="keyword">switch</span> (ctrl) &#123;</div><div class="line"><span class="keyword">case</span> <span class="number">1</span>:</div><div class="line">type = <span class="number">1</span>;</div><div class="line"><span class="keyword">if</span> (!isPlay) &#123;</div><div class="line">prepareAndStart(<span class="number">0</span>, current);</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">pause();</div><div class="line">&#125;</div><div class="line"><span class="keyword">break</span>;</div><div class="line"><span class="keyword">case</span> <span class="number">2</span>:</div><div class="line">pause();</div><div class="line"><span class="keyword">break</span>;</div><div class="line"><span class="keyword">case</span> <span class="number">3</span>:</div><div class="line">stop();</div><div class="line">type = <span class="number">0</span>;</div><div class="line"><span class="keyword">break</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//接收消息后，同时向Activit发送在播放状态，播放曲目id给Activity</span></div><div class="line"><span class="comment">//Activity收到消息后，会播放按钮更新为暂停状态</span></div><div class="line">Intent sendIntent = <span class="keyword">new</span> Intent();</div><div class="line">sendIntent.putExtra(<span class="string">"type"</span>, type);</div><div class="line">sendIntent.putExtra(<span class="string">"status"</span>, isPlay);</div><div class="line">sendIntent.setAction(<span class="string">"org.itair.ui.receiver"</span>);</div><div class="line">sendBroadcast(sendIntent);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Service中音乐播放时把播放进度用广播发送给Activity"><a href="#Service中音乐播放时把播放进度用广播发送给Activity" class="headerlink" title="Service中音乐播放时把播放进度用广播发送给Activity:"></a>Service中音乐播放时把播放进度用广播发送给Activity:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Service中播放音乐的方法</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepareAndStart</span><span class="params">(<span class="keyword">int</span> index, <span class="keyword">int</span> current)</span> </span>&#123;</div><div class="line"></div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">AssetFileDescriptor afd = am.openFd(musics[index]);</div><div class="line">mPlayer.reset();</div><div class="line">mPlayer.setDataSource(afd.getFileDescriptor(),</div><div class="line">afd.getStartOffset(), afd.getLength());</div><div class="line"></div><div class="line">mPlayer.prepare();</div><div class="line">mPlayer.seekTo(current);</div><div class="line">mPlayer.start();</div><div class="line"></div><div class="line">isPlay = <span class="keyword">true</span>;</div><div class="line"></div><div class="line"><span class="keyword">final</span> <span class="keyword">int</span> total = mPlayer.getDuration();</div><div class="line">Runnable runnable = <span class="keyword">new</span> Runnable() &#123;</div><div class="line">Intent sendIntent = <span class="keyword">new</span> Intent();</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="comment">// TODO Auto-generated method stub</span></div><div class="line"></div><div class="line"><span class="keyword">while</span> (isPlay) &#123;</div><div class="line"><span class="comment">// 发送进度广播给Activity</span></div><div class="line">sendIntent.putExtra(<span class="string">"type"</span>, <span class="number">2</span>);</div><div class="line">sendIntent.putExtra(<span class="string">"current"</span>,</div><div class="line"><span class="number">100</span> *mPlayer.getCurrentPosition() / total);</div><div class="line">sendIntent.setAction(<span class="string">"org.itair.ui.receiver"</span>);</div><div class="line">sendBroadcast(sendIntent);</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">Thread.sleep(<span class="number">1000</span>);</div><div class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line"><span class="comment">// TODO Auto-generated catch block</span></div><div class="line">e.printStackTrace();</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">new</span> Thread(runnable).start();</div><div class="line"></div><div class="line">mPlayer.setOnCompletionListener(<span class="keyword">new</span> OnCompletionListener() &#123;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompletion</span><span class="params">(MediaPlayer mp)</span> </span>&#123;</div><div class="line"><span class="comment">// TODO Auto-generated method stub</span></div><div class="line"><span class="comment">//播放完毕发送消息给Activity</span></div><div class="line">isPlay = <span class="keyword">false</span>;</div><div class="line">Intent sendIntent = <span class="keyword">new</span> Intent();</div><div class="line">sendIntent.putExtra(<span class="string">"type"</span>, <span class="number">0</span>);</div><div class="line">sendIntent.putExtra(<span class="string">"status"</span>, isPlay);</div><div class="line">sendIntent.setAction(<span class="string">"org.itair.ui.receiver"</span>);</div><div class="line">sendBroadcast(sendIntent);</div><div class="line"></div><div class="line">&#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line"><span class="comment">// TODO Auto-generated catch block</span></div><div class="line">e.printStackTrace();</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="相应的，Activity中的广播接收者，接收广播进行处理："><a href="#相应的，Activity中的广播接收者，接收广播进行处理：" class="headerlink" title="相应的，Activity中的广播接收者，接收广播进行处理："></a>相应的，Activity中的广播接收者，接收广播进行处理：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UiRecevier</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</div><div class="line"><span class="keyword">int</span> type = intent.getIntExtra(<span class="string">"type"</span>, -<span class="number">1</span>);</div><div class="line"><span class="keyword">switch</span> (type) &#123;</div><div class="line"><span class="comment">//更新播放按钮</span></div><div class="line"><span class="keyword">case</span> <span class="number">0</span>:</div><div class="line">pb.setProgress(<span class="number">0</span>);</div><div class="line">btn_start.setImageResource(R.drawable.play);</div><div class="line"><span class="keyword">break</span>;</div><div class="line"><span class="keyword">case</span> <span class="number">1</span>:</div><div class="line"><span class="keyword">boolean</span> isPlay = intent.getExtras().getBoolean(<span class="string">"status"</span>);</div><div class="line">tv_singer.setText(titles[<span class="number">0</span>]);</div><div class="line"></div><div class="line"><span class="keyword">if</span> (isPlay) &#123;</div><div class="line">btn_start.setImageResource(R.drawable.pause);</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">btn_start.setImageResource(R.drawable.play);</div><div class="line">&#125;</div><div class="line"><span class="keyword">break</span>;</div><div class="line"></div><div class="line"><span class="keyword">case</span> <span class="number">2</span>:</div><div class="line"><span class="comment">//更新进度</span></div><div class="line">pb.setProgress(intent.getExtras().getInt(<span class="string">"current"</span>));</div><div class="line"><span class="keyword">break</span>;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="二、采用绑定服务开启服务的方法暴露Service中的方法，Activity进行调用，Service利用Handler向Activity发送进度消息。（绑定服务-Handler进行通讯）"><a href="#二、采用绑定服务开启服务的方法暴露Service中的方法，Activity进行调用，Service利用Handler向Activity发送进度消息。（绑定服务-Handler进行通讯）" class="headerlink" title="二、采用绑定服务开启服务的方法暴露Service中的方法，Activity进行调用，Service利用Handler向Activity发送进度消息。（绑定服务+Handler进行通讯）"></a>二、采用绑定服务开启服务的方法暴露Service中的方法，Activity进行调用，Service利用Handler向Activity发送进度消息。（绑定服务+Handler进行通讯）</h4><h4 id="Activity中绑定服务："><a href="#Activity中绑定服务：" class="headerlink" title="Activity中绑定服务："></a>Activity中绑定服务：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">conn = <span class="keyword">new</span> MyConn();</div><div class="line">Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, MusicService.class);</div><div class="line">bindService(intent, conn, BIND_AUTO_CREATE);</div><div class="line"></div><div class="line">Service中向Activity中发送播放进度消息（Handler+Message）</div><div class="line"></div><div class="line">Runnable runnable = <span class="keyword">new</span> Runnable() &#123;</div><div class="line">Intent sendIntent = <span class="keyword">new</span> Intent();</div><div class="line"></div><div class="line">Message message = <span class="keyword">null</span>;</div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="comment">// TODO Auto-generated method stub</span></div><div class="line"><span class="keyword">while</span> (isPlay) &#123;</div><div class="line"><span class="comment">//Handler message实现向Activity发送播放进度消息</span></div><div class="line">message = <span class="keyword">new</span> Message();</div><div class="line">message.arg1 = <span class="number">100</span> *mPlayer.getCurrentPosition()</div><div class="line">/ total;</div><div class="line">MainActivity.handler.sendMessage(message);</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">Thread.sleep(<span class="number">1000</span>);</div><div class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line"><span class="comment">// TODO Auto-generated catch block</span></div><div class="line">e.printStackTrace();</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">new</span> Thread(runnable).start();</div></pre></td></tr></table></figure>
<h4 id="注意这个handler是在Activity中声明定义的，且要声明为public-static。"><a href="#注意这个handler是在Activity中声明定义的，且要声明为public-static。" class="headerlink" title="注意这个handler是在Activity中声明定义的，且要声明为public static。"></a>注意这个handler是在Activity中声明定义的，且要声明为public static。</h4><h4 id="Activity中，handler接收到消息后进行进度条的更新。"><a href="#Activity中，handler接收到消息后进行进度条的更新。" class="headerlink" title="Activity中，handler接收到消息后进行进度条的更新。"></a>Activity中，handler接收到消息后进行进度条的更新。</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> Handler handler;</div><div class="line"></div><div class="line">handler = <span class="keyword">new</span> Handler() &#123;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</div><div class="line"><span class="comment">// TODO Auto-generated method stub</span></div><div class="line">pb.setProgress(msg.arg1);</div><div class="line"><span class="keyword">if</span>(msg.arg2==<span class="number">100</span>)&#123;</div><div class="line">pb.setProgress(<span class="number">0</span>);</div><div class="line">btn_start.setImageResource(R.drawable.play);</div><div class="line">isPlay = <span class="keyword">false</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">super</span>.handleMessage(msg);</div><div class="line">&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h4 id="三、其它方式："><a href="#三、其它方式：" class="headerlink" title="三、其它方式："></a>三、其它方式：</h4><h4 id="Activity向Service发送消息，还可以采用Intent，Service采用开启服务-startService-的方式。"><a href="#Activity向Service发送消息，还可以采用Intent，Service采用开启服务-startService-的方式。" class="headerlink" title="Activity向Service发送消息，还可以采用Intent，Service采用开启服务(startService)的方式。"></a>Activity向Service发送消息，还可以采用Intent，Service采用开启服务(startService)的方式。</h4><h4 id="Service向Activity发送消息，网上也有说可以采用Intent打开Activity的方法，但用在播放器更新进度时，不太合适。"><a href="#Service向Activity发送消息，网上也有说可以采用Intent打开Activity的方法，但用在播放器更新进度时，不太合适。" class="headerlink" title="Service向Activity发送消息，网上也有说可以采用Intent打开Activity的方法，但用在播放器更新进度时，不太合适。"></a>Service向Activity发送消息，网上也有说可以采用Intent打开Activity的方法，但用在播放器更新进度时，不太合适。</h4>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://WinterSmileSB101.online/2017/03/22/安卓实现网易云音乐底部播放栏效果之使用自定义BaseActivity实现下/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WinterSmileSB101">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WinterSmileSB101 的个人房间">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/22/安卓实现网易云音乐底部播放栏效果之使用自定义BaseActivity实现下/" itemprop="url">
                  安卓 实现网易云音乐底部播放栏效果之使用自定义BaseActivity实现 下
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-22T17:34:04+08:00">
                2017-03-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/Android-实战/" itemprop="url" rel="index">
                    <span itemprop="name">Android 实战</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/Android-实战/Android-馨乐（音乐APP，UI仿网易云音乐）开发/" itemprop="url" rel="index">
                    <span itemprop="name">Android 馨乐（音乐APP，UI仿网易云音乐）开发</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>版权声明：本文为 wintersmilesb101 -（个人独立博客– <a href="http://wintersmilesb101.online">http://wintersmilesb101.online</a> 欢迎访问）博主原创文章，未经博主允许不得转载。</p>
<p><a href="https://github.com/WinterSmileSB101/winterMusic" target="_blank" rel="external">项目 GitHub 地址</a><br><a href="http://download.csdn.net/detail/qq_21265915/9661736" target="_blank" rel="external">此博文源码下载地址</a></p>
</blockquote>
<h4 id="上一篇文章中，我们已经把BaseActivity建立好了，现在我们要考虑的是什么呢。"><a href="#上一篇文章中，我们已经把BaseActivity建立好了，现在我们要考虑的是什么呢。" class="headerlink" title="上一篇文章中，我们已经把BaseActivity建立好了，现在我们要考虑的是什么呢。"></a>上一篇文章中，我们已经把BaseActivity建立好了，现在我们要考虑的是什么呢。</h4><h4 id="由于音乐播放，所以我们需要用到Service-那么自然就需要用Service对UI界面（也就是我们的播放界面进行更新）-相对的，我们的Activity也会给Service发送诸如播放，停止，暂停，下一首之类的信息。这就涉及到了Service与Activity之间的通信。"><a href="#由于音乐播放，所以我们需要用到Service-那么自然就需要用Service对UI界面（也就是我们的播放界面进行更新）-相对的，我们的Activity也会给Service发送诸如播放，停止，暂停，下一首之类的信息。这就涉及到了Service与Activity之间的通信。" class="headerlink" title="由于音乐播放，所以我们需要用到Service,那么自然就需要用Service对UI界面（也就是我们的播放界面进行更新）,相对的，我们的Activity也会给Service发送诸如播放，停止，暂停，下一首之类的信息。这就涉及到了Service与Activity之间的通信。"></a>由于音乐播放，所以我们需要用到Service,那么自然就需要用Service对UI界面（也就是我们的播放界面进行更新）,相对的，我们的Activity也会给Service发送诸如播放，停止，暂停，下一首之类的信息。这就涉及到了Service与Activity之间的通信。</h4><h4 id="在网上了解了一番，一般有下面的几种方法：具体可以参考这篇博客Service与Activity之间通讯的几种方式，我觉得写的很好，我下面粗略提及一下"><a href="#在网上了解了一番，一般有下面的几种方法：具体可以参考这篇博客Service与Activity之间通讯的几种方式，我觉得写的很好，我下面粗略提及一下" class="headerlink" title="在网上了解了一番，一般有下面的几种方法：具体可以参考这篇博客Service与Activity之间通讯的几种方式，我觉得写的很好，我下面粗略提及一下"></a>在网上了解了一番，一般有下面的几种方法：具体可以参考这篇博客Service与Activity之间通讯的几种方式，我觉得写的很好，我下面粗略提及一下</h4><h4 id="Service向Activity发送消息："><a href="#Service向Activity发送消息：" class="headerlink" title="Service向Activity发送消息："></a>Service向Activity发送消息：</h4><h4 id="1-通过Broadcast，在活动中注册广播接收器，在Service中发送广播，Activity中接收。"><a href="#1-通过Broadcast，在活动中注册广播接收器，在Service中发送广播，Activity中接收。" class="headerlink" title="1.通过Broadcast，在活动中注册广播接收器，在Service中发送广播，Activity中接收。"></a>1.通过Broadcast，在活动中注册广播接收器，在Service中发送广播，Activity中接收。</h4><h4 id="2-通过Handler，在活动中写Handler，在Service中调用活动中的Handler来向Handler传递消息。"><a href="#2-通过Handler，在活动中写Handler，在Service中调用活动中的Handler来向Handler传递消息。" class="headerlink" title="2.通过Handler，在活动中写Handler，在Service中调用活动中的Handler来向Handler传递消息。"></a>2.通过Handler，在活动中写Handler，在Service中调用活动中的Handler来向Handler传递消息。</h4><h4 id="Activity向Service发送消息："><a href="#Activity向Service发送消息：" class="headerlink" title="Activity向Service发送消息："></a>Activity向Service发送消息：</h4><h4 id="1-通过BindService绑定服务的方式开启服务，接受到服务连接对象，也就是桥，这个桥可以让Service中的方法公开给这个Activity。通过绑定对象就可以直接访问到服务里的方法从而传输数据。"><a href="#1-通过BindService绑定服务的方式开启服务，接受到服务连接对象，也就是桥，这个桥可以让Service中的方法公开给这个Activity。通过绑定对象就可以直接访问到服务里的方法从而传输数据。" class="headerlink" title="1.通过BindService绑定服务的方式开启服务，接受到服务连接对象，也就是桥，这个桥可以让Service中的方法公开给这个Activity。通过绑定对象就可以直接访问到服务里的方法从而传输数据。"></a>1.通过BindService绑定服务的方式开启服务，接受到服务连接对象，也就是桥，这个桥可以让Service中的方法公开给这个Activity。通过绑定对象就可以直接访问到服务里的方法从而传输数据。</h4><h4 id="2-通过Intent打开服务的方式传送数据。"><a href="#2-通过Intent打开服务的方式传送数据。" class="headerlink" title="2.通过Intent打开服务的方式传送数据。"></a>2.通过Intent打开服务的方式传送数据。</h4><h4 id="3-通过Broadcast广播传送，在服务中注册广播接收器，在活动中发出消息，在服务中接收。"><a href="#3-通过Broadcast广播传送，在服务中注册广播接收器，在活动中发出消息，在服务中接收。" class="headerlink" title="3.通过Broadcast广播传送，在服务中注册广播接收器，在活动中发出消息，在服务中接收。"></a>3.通过Broadcast广播传送，在服务中注册广播接收器，在活动中发出消息，在服务中接收。</h4><h4 id="正题："><a href="#正题：" class="headerlink" title="正题："></a>正题：</h4><h4 id="一-这里Service向Activity传递消息使用广播的方式："><a href="#一-这里Service向Activity传递消息使用广播的方式：" class="headerlink" title="一.这里Service向Activity传递消息使用广播的方式："></a>一.这里Service向Activity传递消息使用广播的方式：</h4><h4 id="定义广播Action："><a href="#定义广播Action：" class="headerlink" title="定义广播Action："></a>定义广播Action：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">	 * 音乐服务广播动作字符串</div><div class="line">	 */</div><div class="line">	<span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String MusicServiceReceiverAction = <span class="string">"winter.zxb.smilesb101.winterMusic.service.receiver"</span>;<span class="comment">//这里的动作可以自定义，只要区别不同的广播以及接收端和发送端相同的Action</span></div></pre></td></tr></table></figure>
<h4 id="1-首先在需要接受消息的Activity中新建广播接收器："><a href="#1-首先在需要接受消息的Activity中新建广播接收器：" class="headerlink" title="1.首先在需要接受消息的Activity中新建广播接收器："></a>1.首先在需要接受消息的Activity中新建广播接收器：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">     *  广播接收器</div><div class="line">     * Created by SmileSB101 on 2016/10/19 0019.</div><div class="line">     */  </div><div class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UI_Receiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span></span>&#123;  </div><div class="line">        <span class="meta">@Override</span>  </div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context,Intent intent)</span></span>&#123;  </div><div class="line">            <span class="keyword">int</span> type = intent.getIntExtra(MusicServices.BROADCAST.TYPE_TYPENAME,-<span class="number">2</span>);  </div><div class="line">            <span class="keyword">int</span> value = <span class="number">0</span>;  </div><div class="line">            <span class="comment">//Log.i("收到消息",type+"");  </span></div><div class="line">            <span class="keyword">switch</span>(type)  </div><div class="line">            &#123;  </div><div class="line">                <span class="comment">//这里进行消息对应处理  </span></div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h4 id="2-在活动的onCreat（）方法中注册广播："><a href="#2-在活动的onCreat（）方法中注册广播：" class="headerlink" title="2.在活动的onCreat（）方法中注册广播："></a>2.在活动的onCreat（）方法中注册广播：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">IntentFilter intentFilter = <span class="keyword">new</span> IntentFilter();</div><div class="line">ui_receiver = <span class="keyword">new</span> UI_Receiver();</div><div class="line">intentFilter.addAction(MusicServices.MusicServiceReceiverAction);  </div><div class="line"><span class="comment">//注册应用内广播接收器，为了不让其他应用接收到广播  </span></div><div class="line">localBroadcastManager = LocalBroadcastManager.getInstance(<span class="keyword">this</span>);  </div><div class="line">localBroadcastManager.registerReceiver(ui_receiver, intentFilter);</div></pre></td></tr></table></figure>
<h4 id="3-服务中注册广播，在onCreate-方法中："><a href="#3-服务中注册广播，在onCreate-方法中：" class="headerlink" title="3.服务中注册广播，在onCreate()方法中："></a>3.服务中注册广播，在onCreate()方法中：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//初始化广播</span></div><div class="line">			musicServicesBroadcastReceiver = <span class="keyword">new</span> MusicServicesBroadcastReceiver();</div><div class="line">			IntentFilter intentFilter = <span class="keyword">new</span> IntentFilter();</div><div class="line">			intentFilter.addAction(MusicServiceReceiverAction);</div><div class="line">			<span class="comment">//本地广播注册</span></div><div class="line">			localBroadcastManager = LocalBroadcastManager.getInstance(<span class="keyword">this</span>);</div><div class="line">			localBroadcastManager.registerReceiver(musicServicesBroadcastReceiver,intentFilter);</div></pre></td></tr></table></figure>
<h4 id="4-发送数据的方法："><a href="#4-发送数据的方法：" class="headerlink" title="4.发送数据的方法："></a>4.发送数据的方法：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Intent intent = <span class="keyword">new</span> Intent(MusicServiceReceiverAction);</div><div class="line">			<span class="keyword">int</span> value = <span class="number">0</span>;<span class="comment">//这里需要传入什么就写什么</span></div><div class="line">			intent.putExtra(<span class="string">"key"</span>,value);<span class="comment">//这里的key是键值对的键，在后面的取值时需要用到，自定义，</span></div><div class="line">			localBroadcastManager.sendBroadcast(intent);<span class="comment">//发送广播</span></div></pre></td></tr></table></figure>
<h4 id="5-还要注意一点我们需要在onDestory（）方法中取消广播的注册"><a href="#5-还要注意一点我们需要在onDestory（）方法中取消广播的注册" class="headerlink" title="5.还要注意一点我们需要在onDestory（）方法中取消广播的注册"></a>5.还要注意一点我们需要在onDestory（）方法中取消广播的注册</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//取消注册应用内广播接收器  </span></div><div class="line">        localBroadcastManager.unregisterReceiver(ui_receiver);</div></pre></td></tr></table></figure>
<h4 id="这样就完成了Service向Activity数据的传递；"><a href="#这样就完成了Service向Activity数据的传递；" class="headerlink" title="这样就完成了Service向Activity数据的传递；"></a>这样就完成了Service向Activity数据的传递；</h4><h3 id="二-Activity向Service传递数据，这里使用绑定开启服务的方式"><a href="#二-Activity向Service传递数据，这里使用绑定开启服务的方式" class="headerlink" title="二.Activity向Service传递数据，这里使用绑定开启服务的方式"></a>二.Activity向Service传递数据，这里使用绑定开启服务的方式</h3><h4 id="1-在Activity中建立桥梁（ServiceConnection），以及Service绑定对象："><a href="#1-在Activity中建立桥梁（ServiceConnection），以及Service绑定对象：" class="headerlink" title="1.在Activity中建立桥梁（ServiceConnection），以及Service绑定对象："></a>1.在Activity中建立桥梁（ServiceConnection），以及Service绑定对象：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">     * 音乐服务Bind对象</div><div class="line">     */  </div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> MusicServices.MusicIBind musicIBind;  </div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 服务连接对象</div><div class="line">     */  </div><div class="line">    <span class="keyword">public</span> ServiceConnection mServiceConnection = <span class="keyword">new</span> ServiceConnection() &#123;  </div><div class="line"></div><div class="line">        <span class="meta">@Override</span>  </div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name,IBinder service)</span> </span>&#123;  </div><div class="line">            <span class="comment">//绑定成功后，取得MusicSercice提供的接口  </span></div><div class="line">            musicIBind = (MusicServices.MusicIBind) service;  </div><div class="line">        &#125;  </div><div class="line"></div><div class="line">        <span class="meta">@Override</span>  </div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName name)</span> </span>&#123;  </div><div class="line">        &#125;  </div><div class="line">    &#125;;</div></pre></td></tr></table></figure>
<h4 id="2-在Activity需要调用的地方直接使用绑定对象即可："><a href="#2-在Activity需要调用的地方直接使用绑定对象即可：" class="headerlink" title="2.在Activity需要调用的地方直接使用绑定对象即可："></a>2.在Activity需要调用的地方直接使用绑定对象即可：</h4><h4 id="比如在服务中有playMusic（）方法，那么调用方式就是musicIBind-playMusic-即可。"><a href="#比如在服务中有playMusic（）方法，那么调用方式就是musicIBind-playMusic-即可。" class="headerlink" title="比如在服务中有playMusic（）方法，那么调用方式就是musicIBind.playMusic()即可。"></a>比如在服务中有playMusic（）方法，那么调用方式就是musicIBind.playMusic()即可。</h4><h4 id="3-还有一点就是要在onDestory-方法中取消服务的绑定："><a href="#3-还有一点就是要在onDestory-方法中取消服务的绑定：" class="headerlink" title="3.还有一点就是要在onDestory()方法中取消服务的绑定："></a>3.还有一点就是要在onDestory()方法中取消服务的绑定：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//取消服务绑定  </span></div><div class="line">        unbindService(mServiceConnection);</div></pre></td></tr></table></figure>
<h4 id="这样就实现了活动与服务的数据交流。是不是很简单。如有问题，欢迎指正。"><a href="#这样就实现了活动与服务的数据交流。是不是很简单。如有问题，欢迎指正。" class="headerlink" title="这样就实现了活动与服务的数据交流。是不是很简单。如有问题，欢迎指正。"></a>这样就实现了活动与服务的数据交流。是不是很简单。如有问题，欢迎指正。</h4>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://WinterSmileSB101.online/2017/03/22/安卓实现网易云音乐底部播放栏效果之使用UI绑定到Service上实现/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WinterSmileSB101">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WinterSmileSB101 的个人房间">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/22/安卓实现网易云音乐底部播放栏效果之使用UI绑定到Service上实现/" itemprop="url">
                  安卓实现网易云音乐底部播放栏效果之使用UI绑定到Service上实现
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-22T17:12:58+08:00">
                2017-03-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/Android-实战/" itemprop="url" rel="index">
                    <span itemprop="name">Android 实战</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/Android-实战/Android-馨乐（音乐APP，UI仿网易云音乐）开发/" itemprop="url" rel="index">
                    <span itemprop="name">Android 馨乐（音乐APP，UI仿网易云音乐）开发</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>版权声明：本文为 wintersmilesb101 -（个人独立博客– <a href="http://wintersmilesb101.online">http://wintersmilesb101.online</a> 欢迎访问）博主原创文章，未经博主允许不得转载。</p>
<p><a href="https://github.com/WinterSmileSB101/winterMusic" target="_blank" rel="external">项目 GitHub 地址</a><br><a href="http://download.csdn.net/detail/qq_21265915/9661736" target="_blank" rel="external">此博文源码下载地址</a></p>
</blockquote>
<h4 id="先说原理：音乐播放需要使用到-Service，而播放栏也是属于音乐播放的，那么为什么我们不把这两者合在一起呢？"><a href="#先说原理：音乐播放需要使用到-Service，而播放栏也是属于音乐播放的，那么为什么我们不把这两者合在一起呢？" class="headerlink" title="先说原理：音乐播放需要使用到 Service，而播放栏也是属于音乐播放的，那么为什么我们不把这两者合在一起呢？"></a>先说原理：音乐播放需要使用到 Service，而播放栏也是属于音乐播放的，那么为什么我们不把这两者合在一起呢？</h4><h4 id="把UI和音乐-Service-合在一起，用-Service-来控制-UI-界面不是更简单。在进入-Activity-的时候判定是否播放列表不为空或者是否正在播放音乐来动态添加UI界面。简单的这样就实现了播放栏的常驻（虽然只是看起来，但是挺简单的，完成后效果也不错）。"><a href="#把UI和音乐-Service-合在一起，用-Service-来控制-UI-界面不是更简单。在进入-Activity-的时候判定是否播放列表不为空或者是否正在播放音乐来动态添加UI界面。简单的这样就实现了播放栏的常驻（虽然只是看起来，但是挺简单的，完成后效果也不错）。" class="headerlink" title="把UI和音乐 Service 合在一起，用 Service 来控制 UI 界面不是更简单。在进入 Activity 的时候判定是否播放列表不为空或者是否正在播放音乐来动态添加UI界面。简单的这样就实现了播放栏的常驻（虽然只是看起来，但是挺简单的，完成后效果也不错）。"></a>把UI和音乐 Service 合在一起，用 Service 来控制 UI 界面不是更简单。在进入 Activity 的时候判定是否播放列表不为空或者是否正在播放音乐来动态添加UI界面。简单的这样就实现了播放栏的常驻（虽然只是看起来，但是挺简单的，完成后效果也不错）。</h4><h4 id="实现："><a href="#实现：" class="headerlink" title="实现："></a>实现：</h4><h4 id="1-建立-MusicService-类，继承自-Service-基类，并且实现基本的音乐播放逻辑，这里我实现了添加播放列表以及播放的方法。我预想的网易云音乐的播放面板存在逻辑为，只要播放列表不为空以及列表内存在可播放音乐，就存在这个音乐播放控制面板。这里为了简单，我们就先只检查播放列表是否为空，不为空就实例化出来播放控制面板。为空的话就去掉。这里我-Activity-发消息给-Service-是通过绑定开启服务的方式，具体实现不再赘述，直接说添加播放列表方法："><a href="#1-建立-MusicService-类，继承自-Service-基类，并且实现基本的音乐播放逻辑，这里我实现了添加播放列表以及播放的方法。我预想的网易云音乐的播放面板存在逻辑为，只要播放列表不为空以及列表内存在可播放音乐，就存在这个音乐播放控制面板。这里为了简单，我们就先只检查播放列表是否为空，不为空就实例化出来播放控制面板。为空的话就去掉。这里我-Activity-发消息给-Service-是通过绑定开启服务的方式，具体实现不再赘述，直接说添加播放列表方法：" class="headerlink" title="1.建立 MusicService 类，继承自 Service 基类，并且实现基本的音乐播放逻辑，这里我实现了添加播放列表以及播放的方法。我预想的网易云音乐的播放面板存在逻辑为，只要播放列表不为空以及列表内存在可播放音乐，就存在这个音乐播放控制面板。这里为了简单，我们就先只检查播放列表是否为空，不为空就实例化出来播放控制面板。为空的话就去掉。这里我 Activity 发消息给 Service 是通过绑定开启服务的方式，具体实现不再赘述，直接说添加播放列表方法："></a>1.建立 MusicService 类，继承自 Service 基类，并且实现基本的音乐播放逻辑，这里我实现了添加播放列表以及播放的方法。我预想的网易云音乐的播放面板存在逻辑为，只要播放列表不为空以及列表内存在可播放音乐，就存在这个音乐播放控制面板。这里为了简单，我们就先只检查播放列表是否为空，不为空就实例化出来播放控制面板。为空的话就去掉。这里我 Activity 发消息给 Service 是通过绑定开启服务的方式，具体实现不再赘述，直接说添加播放列表方法：</h4><h4 id="在-Service-中定义添加播放列表方法，如果是只添加一首，那么就播放这一首，添加多首就不改变当前的播放状态："><a href="#在-Service-中定义添加播放列表方法，如果是只添加一首，那么就播放这一首，添加多首就不改变当前的播放状态：" class="headerlink" title="在 Service 中定义添加播放列表方法，如果是只添加一首，那么就播放这一首，添加多首就不改变当前的播放状态："></a>在 Service 中定义添加播放列表方法，如果是只添加一首，那么就播放这一首，添加多首就不改变当前的播放状态：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">     * 添加音乐到播放列表,添加一首</div><div class="line">     */  </div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addPlayListInner</span><span class="params">(Mp3Info mp3s)</span></span>&#123;  </div><div class="line">        <span class="keyword">if</span>(!PlayList.contains(mp3s))  </div><div class="line">        &#123;  </div><div class="line">            <span class="comment">//不存在这首歌曲，直接存入  </span></div><div class="line">            <span class="comment">//播放这首歌返回  </span></div><div class="line">            Help.INSERT_VALUES_TO_SQLITE(PlayListContentProvider.CONTENT_SONGS_URI,mp3s);<span class="comment">//存入数据库保存  </span></div><div class="line">            PlayList.add(mp3s);  </div><div class="line">            CurrentPlayPosition = PlayList.size()-<span class="number">1</span>;<span class="comment">//赋值当前播放位置为现在的位置  </span></div><div class="line">        &#125;  </div><div class="line">        <span class="comment">//播放当前音乐  </span></div><div class="line">        playInner(CurrentPlayPosition);  </div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h4 id="下面再来看播放方法（只是一个基础例子，需要完善的还有很多）："><a href="#下面再来看播放方法（只是一个基础例子，需要完善的还有很多）：" class="headerlink" title="下面再来看播放方法（只是一个基础例子，需要完善的还有很多）："></a>下面再来看播放方法（只是一个基础例子，需要完善的还有很多）：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">     * 实现方法</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> position 播放位置</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */  </div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">playInner</span><span class="params">(<span class="keyword">int</span> position)</span></span>&#123;  </div><div class="line">        <span class="keyword">try</span> &#123;  </div><div class="line">            playPreInner(position);  </div><div class="line">            mediaPlayer.start();  </div><div class="line">            isPlaying = <span class="keyword">true</span>;  </div><div class="line">            CreateFloatView();  </div><div class="line">            setPlayBarValue(PlayList.get(CurrentPlayPosition),mediaPlayer);<span class="comment">//设置播放栏  </span></div><div class="line">            <span class="comment">//使用定时器提交播放进度  </span></div><div class="line">            Timer timer = <span class="keyword">new</span> Timer();  </div><div class="line">            TimerTask task = <span class="keyword">new</span> TimerTask()&#123;  </div><div class="line">                <span class="meta">@Override</span>  </div><div class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;  </div><div class="line">                    musicProcessBar.setProgress(mediaPlayer.getCurrentPosition());  </div><div class="line">                &#125;  </div><div class="line">            &#125;;  </div><div class="line">            timer.schedule(task,<span class="number">0</span>,<span class="number">1000</span>);  </div><div class="line">        &#125;  </div><div class="line">        <span class="keyword">catch</span>(Exception e)  </div><div class="line">        &#123;  </div><div class="line">            e.printStackTrace();  </div><div class="line">        &#125;  </div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;  </div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h4 id="可以看到，上面播放音乐的方法中我们调用了一个方法，是CreateFloatView（）–这是用来创建播放控制面板的，实现如下："><a href="#可以看到，上面播放音乐的方法中我们调用了一个方法，是CreateFloatView（）–这是用来创建播放控制面板的，实现如下：" class="headerlink" title="可以看到，上面播放音乐的方法中我们调用了一个方法，是CreateFloatView（）–这是用来创建播放控制面板的，实现如下："></a>可以看到，上面播放音乐的方法中我们调用了一个方法，是CreateFloatView（）–这是用来创建播放控制面板的，实现如下：</h4><h4 id="布局文件："><a href="#布局文件：" class="headerlink" title="布局文件："></a>布局文件：</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;  </div><div class="line"><span class="comment">&lt;!--浮动音乐控制布局--&gt;</span>  </div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>  </span></div><div class="line">              <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span>  </div><div class="line">              <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>  </div><div class="line">    <span class="attr">android:layout_gravity</span>=<span class="string">"bottom"</span>  </div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/float_Music_Container"</span>  </div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>  </div><div class="line">    <span class="attr">android:background</span>=<span class="string">"@color/colorHalfTransparentWrite"</span>&gt;  </div><div class="line">    <span class="tag">&lt;<span class="name">RelativeLayout</span>  </span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span>  </div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>  </div><div class="line">        <span class="attr">android:layout_gravity</span>=<span class="string">"bottom"</span>  </div><div class="line">        <span class="attr">android:background</span>=<span class="string">"@color/colorHalfTransparentWrite"</span>&gt;  </div><div class="line">        <span class="comment">&lt;!--音乐图片--&gt;</span>  </div><div class="line">        <span class="tag">&lt;<span class="name">ImageView</span>  </span></div><div class="line">            <span class="attr">android:id</span>=<span class="string">"@+id/float_MusicImage"</span>  </div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span>  </div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>  </div><div class="line">            <span class="attr">android:layout_marginLeft</span>=<span class="string">"10dp"</span>  </div><div class="line">            <span class="attr">android:layout_centerVertical</span>=<span class="string">"true"</span>/&gt;  </div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">LinearLayout</span>  </span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span>  </div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>  </div><div class="line">            <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>  </div><div class="line">            <span class="attr">android:layout_toEndOf</span>=<span class="string">"@+id/float_MusicImage"</span>  </div><div class="line">            <span class="attr">android:layout_marginLeft</span>=<span class="string">"5dp"</span>&gt;  </div><div class="line">            <span class="tag">&lt;<span class="name">TextView</span>  </span></div><div class="line">                <span class="attr">android:id</span>=<span class="string">"@+id/float_Music_Name"</span>  </div><div class="line">                <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span>  </div><div class="line">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>  </div><div class="line">                <span class="attr">android:textSize</span>=<span class="string">"20dp"</span>  </div><div class="line">                <span class="attr">android:textColor</span>=<span class="string">"#000000"</span>/&gt;  </div><div class="line">            <span class="tag">&lt;<span class="name">TextView</span>  </span></div><div class="line">                <span class="attr">android:id</span>=<span class="string">"@+id/float_Music_Artist"</span>  </div><div class="line">                <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span>  </div><div class="line">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>  </div><div class="line">                <span class="attr">android:textColor</span>=<span class="string">"@color/colorPrimarySliver"</span>  </div><div class="line">                <span class="attr">android:textSize</span>=<span class="string">"14dp"</span>  </div><div class="line">                <span class="attr">android:layout_marginTop</span>=<span class="string">"3dp"</span>/&gt;  </div><div class="line">        <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span>  </div><div class="line">        <span class="comment">&lt;!--右边的控制按钮--&gt;</span>  </div><div class="line">        <span class="tag">&lt;<span class="name">RelativeLayout</span>  </span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"180dp"</span>  </div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"50dp"</span>  </div><div class="line">            <span class="attr">android:layout_centerVertical</span>=<span class="string">"true"</span>  </div><div class="line">            <span class="attr">android:layout_alignParentEnd</span>=<span class="string">"true"</span>&gt;  </div><div class="line">            <span class="comment">&lt;!--播放列表按钮--&gt;</span>  </div><div class="line">            <span class="tag">&lt;<span class="name">ImageView</span>  </span></div><div class="line">                <span class="attr">android:id</span>=<span class="string">"@+id/float_Play_List"</span>  </div><div class="line">                <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span>  </div><div class="line">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>  </div><div class="line">                <span class="attr">android:layout_alignParentStart</span>=<span class="string">"true"</span>  </div><div class="line">                <span class="attr">android:layout_centerVertical</span>=<span class="string">"true"</span>  </div><div class="line">                <span class="attr">android:src</span>=<span class="string">"@drawable/playbar_btn_playlist"</span>/&gt;  </div><div class="line">            <span class="comment">&lt;!--播放或者暂停按钮--&gt;</span>  </div><div class="line">            <span class="tag">&lt;<span class="name">ImageView</span>  </span></div><div class="line">                <span class="attr">android:id</span>=<span class="string">"@+id/float_Play_Btn"</span>  </div><div class="line">                <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span>  </div><div class="line">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>  </div><div class="line">                <span class="attr">android:layout_centerInParent</span>=<span class="string">"true"</span>  </div><div class="line">                <span class="attr">android:src</span>=<span class="string">"@drawable/playbar_play_btn"</span>/&gt;  </div><div class="line">            <span class="comment">&lt;!--下一曲音乐--&gt;</span>  </div><div class="line">            <span class="tag">&lt;<span class="name">ImageView</span>  </span></div><div class="line">                <span class="attr">android:id</span>=<span class="string">"@+id/float_Next_Music"</span>  </div><div class="line">                <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span>  </div><div class="line">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>  </div><div class="line">                <span class="attr">android:layout_alignParentEnd</span>=<span class="string">"true"</span>  </div><div class="line">                <span class="attr">android:layout_centerVertical</span>=<span class="string">"true"</span>  </div><div class="line">                <span class="attr">android:src</span>=<span class="string">"@drawable/playbar_play_next_btn"</span>/&gt;  </div><div class="line">        <span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span>  </div><div class="line"><span class="comment">&lt;!--音乐进度--&gt;</span>  </div><div class="line">    <span class="tag">&lt;<span class="name">ProgressBar</span>  </span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/float_Music_ProgressBar"</span>  </div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span>  </div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>  </div><div class="line">        <span class="attr">android:progress</span>=<span class="string">"0"</span>  </div><div class="line">        <span class="attr">android:visibility</span>=<span class="string">"visible"</span>  </div><div class="line">        <span class="attr">style</span>=<span class="string">"@style/ProgressBar_Mini"</span>/&gt;    </div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="实现方法："><a href="#实现方法：" class="headerlink" title="实现方法："></a>实现方法：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">     * 建立底部浮动栏的方法</div><div class="line">     */  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CreateFloatView</span><span class="params">()</span></span>&#123;  </div><div class="line">        <span class="keyword">if</span>(PlayList.size() &gt; <span class="number">0</span>) &#123;  </div><div class="line">            mFloatView = LayoutInflater.from(getBaseContext()).inflate(R.layout.float_music_control_layout,<span class="keyword">null</span>);  </div><div class="line">            ViewGroup mDecorView = (ViewGroup)StaticValue.NowActivity.getWindow().getDecorView();  </div><div class="line">            mContentContainer = (FrameLayout)((ViewGroup)mDecorView.getChildAt(<span class="number">0</span>)).getChildAt(<span class="number">1</span>);  </div><div class="line">            FrameLayout.LayoutParams layoutParams = <span class="keyword">new</span> FrameLayout.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT,ViewGroup.LayoutParams.WRAP_CONTENT);  </div><div class="line">            musicProcessBar = (ProgressBar)mFloatView.findViewById(R.id.float_Music_ProgressBar);  </div><div class="line">            musicImageView = (ImageView)mFloatView.findViewById(R.id.float_MusicImage);  </div><div class="line">            musicNameTextView = (TextView)mFloatView.findViewById(R.id.float_Music_Name);  </div><div class="line">            musicArtistTextView = (TextView)mFloatView.findViewById(R.id.float_Music_Artist);  </div><div class="line">            musicPlayBtn = (ImageView)mFloatView.findViewById(R.id.float_Play_Btn);  </div><div class="line">            musicNextBtn = (ImageView)mFloatView.findViewById(R.id.float_Next_Music);  </div><div class="line">            musicPlayListBtn = (ImageView)mFloatView.findViewById(R.id.float_Play_List);  </div><div class="line">            mFloatView.findViewById(R.id.float_Music_Container).setOnClickListener(<span class="keyword">this</span>);  </div><div class="line">            musicPlayBtn.setOnClickListener(<span class="keyword">this</span>);  </div><div class="line">            musicPlayListBtn.setOnClickListener(<span class="keyword">this</span>);  </div><div class="line">            musicNextBtn.setOnClickListener(<span class="keyword">this</span>);  </div><div class="line">            <span class="comment">//获取当前正在播放的音乐  </span></div><div class="line">            layoutParams.gravity = Gravity.BOTTOM;<span class="comment">//设置对齐位置  </span></div><div class="line">            mContentContainer.addView(mFloatView,layoutParams);  </div><div class="line">            <span class="keyword">if</span>(! mediaPlayer.isPlaying()) &#123;  </div><div class="line">                <span class="comment">//没有正在播放的，准备当前位置的音乐，设置值  </span></div><div class="line">                playPreInner(- <span class="number">1</span>);  </div><div class="line">            &#125;  </div><div class="line">            setPlayBarValue(PlayList.get(CurrentPlayPosition),mediaPlayer);<span class="comment">//设置播放控制面板的值  </span></div><div class="line">        &#125;  </div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h4 id="可以看到，这里又调用了一个setPlayBarVlaue（mp3info-MediaPlayer）方法，下面我们来看看实现："><a href="#可以看到，这里又调用了一个setPlayBarVlaue（mp3info-MediaPlayer）方法，下面我们来看看实现：" class="headerlink" title="可以看到，这里又调用了一个setPlayBarVlaue（mp3info,MediaPlayer）方法，下面我们来看看实现："></a>可以看到，这里又调用了一个setPlayBarVlaue（mp3info,MediaPlayer）方法，下面我们来看看实现：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">     * 设置播放栏的值</div><div class="line">     * <span class="doctag">@param</span> NowMp3 正在播放的mp3对象</div><div class="line">     * <span class="doctag">@param</span> mediaPlayer1 当前的mediaPlayer对象</div><div class="line">     */  </div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setPlayBarValue</span><span class="params">(Mp3Info NowMp3,MediaPlayer mediaPlayer1)</span>  </span></div><div class="line">    &#123;  </div><div class="line">        musicProcessBar.setMax(mediaPlayer1.getDuration());<span class="comment">//设置播放进度进度条最大值，  </span></div><div class="line">        musicProcessBar.setProgress(mediaPlayer1.getCurrentPosition());<span class="comment">//设置播放进度条当前进度值  </span></div><div class="line">        musicNameTextView.setText(NowMp3.getDisplayName());<span class="comment">//设置音乐名称  </span></div><div class="line">        musicImageView.setImageResource(R.drawable.ic_menu_gallery);<span class="comment">//设置音乐专辑图片  </span></div><div class="line">        musicArtistTextView.setText(NowMp3.getArtist());<span class="comment">//设置歌手名称  </span></div><div class="line">        <span class="comment">//设置为暂停的图片  </span></div><div class="line">        musicPlayBtn.setImageResource(R.mipmap.playbar_btn_pause);  </div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h4 id="我们接着在服务的onCreate方法中调用CreateFloatView（）方法以便打开应用的时候检测是否添加播放栏，还有"><a href="#我们接着在服务的onCreate方法中调用CreateFloatView（）方法以便打开应用的时候检测是否添加播放栏，还有" class="headerlink" title="我们接着在服务的onCreate方法中调用CreateFloatView（）方法以便打开应用的时候检测是否添加播放栏，还有"></a>我们接着在服务的onCreate方法中调用CreateFloatView（）方法以便打开应用的时候检测是否添加播放栏，还有</h4><h4 id="重点：：：："><a href="#重点：：：：" class="headerlink" title="重点：：：："></a>重点：：：：</h4><h4 id="在onResume（）方法中也调用CreateFloatView（）方法，这样才能让已经被挂起的Activity重新进入前台时能够检查是否添加播放栏！"><a href="#在onResume（）方法中也调用CreateFloatView（）方法，这样才能让已经被挂起的Activity重新进入前台时能够检查是否添加播放栏！" class="headerlink" title="在onResume（）方法中也调用CreateFloatView（）方法，这样才能让已经被挂起的Activity重新进入前台时能够检查是否添加播放栏！"></a>在onResume（）方法中也调用CreateFloatView（）方法，这样才能让已经被挂起的Activity重新进入前台时能够检查是否添加播放栏！</h4><h4 id="在onResume（）方法中也调用CreateFloatView（）方法，这样才能让已经被挂起的Activity重新进入前台时能够检查是否添加播放栏！-1"><a href="#在onResume（）方法中也调用CreateFloatView（）方法，这样才能让已经被挂起的Activity重新进入前台时能够检查是否添加播放栏！-1" class="headerlink" title="在onResume（）方法中也调用CreateFloatView（）方法，这样才能让已经被挂起的Activity重新进入前台时能够检查是否添加播放栏！"></a>在onResume（）方法中也调用CreateFloatView（）方法，这样才能让已经被挂起的Activity重新进入前台时能够检查是否添加播放栏！</h4><h4 id="在onResume（）方法中也调用CreateFloatView（）方法，这样才能让已经被挂起的Activity重新进入前台时能够检查是否添加播放栏！-2"><a href="#在onResume（）方法中也调用CreateFloatView（）方法，这样才能让已经被挂起的Activity重新进入前台时能够检查是否添加播放栏！-2" class="headerlink" title="在onResume（）方法中也调用CreateFloatView（）方法，这样才能让已经被挂起的Activity重新进入前台时能够检查是否添加播放栏！"></a>在onResume（）方法中也调用CreateFloatView（）方法，这样才能让已经被挂起的Activity重新进入前台时能够检查是否添加播放栏！</h4><h4 id="事重三！下面看看效果："><a href="#事重三！下面看看效果：" class="headerlink" title="事重三！下面看看效果："></a>事重三！下面看看效果：</h4><h4 id="由于这种效果使用静态图片不好观看，动态图还没弄好软件，我看再搞搞，先忍受这个东西吧："><a href="#由于这种效果使用静态图片不好观看，动态图还没弄好软件，我看再搞搞，先忍受这个东西吧：" class="headerlink" title="由于这种效果使用静态图片不好观看，动态图还没弄好软件，我看再搞搞，先忍受这个东西吧："></a>由于这种效果使用静态图片不好观看，动态图还没弄好软件，我看再搞搞，先忍受这个东西吧：</h4><h4 id="程序进入："><a href="#程序进入：" class="headerlink" title="程序进入："></a>程序进入：</h4><p><img src="http://img.blog.csdn.net/20161023190455232?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="image"></p>
<h4 id="点击音乐栏目："><a href="#点击音乐栏目：" class="headerlink" title="点击音乐栏目："></a>点击音乐栏目：</h4><p><img src="http://img.blog.csdn.net/20161023190524601?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="image"></p>
<h4 id="点击本地音乐："><a href="#点击本地音乐：" class="headerlink" title="点击本地音乐："></a>点击本地音乐：</h4><p><img src="http://img.blog.csdn.net/20161023190530764?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="image"></p>
<h4 id="点击扫描："><a href="#点击扫描：" class="headerlink" title="点击扫描："></a>点击扫描：</h4><p><img src="http://img.blog.csdn.net/20161023190536805?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="image"></p>
<h4 id="扫描完成："><a href="#扫描完成：" class="headerlink" title="扫描完成："></a>扫描完成：</h4><p><img src="http://img.blog.csdn.net/20161023190546414?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="image"></p>
<h4 id="回到音乐界面："><a href="#回到音乐界面：" class="headerlink" title="回到音乐界面："></a>回到音乐界面：</h4><p><img src="http://img.blog.csdn.net/20161023190555227?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="image"></p>
<h4 id="点击一首歌曲播放，播放面板就显示出来了！-在此感谢能够看到这里的各位看官-："><a href="#点击一首歌曲播放，播放面板就显示出来了！-在此感谢能够看到这里的各位看官-：" class="headerlink" title="点击一首歌曲播放，播放面板就显示出来了！(在此感谢能够看到这里的各位看官)："></a>点击一首歌曲播放，播放面板就显示出来了！(在此感谢能够看到这里的各位看官)：</h4><p><img src="http://img.blog.csdn.net/20161023190605920?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="image"></p>
<h4 id="现在我们返回主界面看看是否有播放面板："><a href="#现在我们返回主界面看看是否有播放面板：" class="headerlink" title="现在我们返回主界面看看是否有播放面板："></a>现在我们返回主界面看看是否有播放面板：</h4><p><img src="http://img.blog.csdn.net/20161023190618014?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="image"><br>播放面板已经有了，说明我们的逻辑是对的，看起来效果也还不错。感谢您能够看到这里，敬礼！<br>需要源码的我已经上传到了我的CSDN <a href="http://download.csdn.net/detail/qq_21265915/9661736" target="_blank" rel="external">下载地址</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://WinterSmileSB101.online/2017/03/22/Android中利用Random生成随机数/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WinterSmileSB101">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WinterSmileSB101 的个人房间">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/22/Android中利用Random生成随机数/" itemprop="url">
                  Android中利用Random生成随机数
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-22T17:10:22+08:00">
                2017-03-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/Android-实战/" itemprop="url" rel="index">
                    <span itemprop="name">Android 实战</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>版权声明：本文为 wintersmilesb101 -（个人独立博客– <a href="http://wintersmilesb101.online">http://wintersmilesb101.online</a> 欢迎访问）博主转载文章，<a href="http://www.2cto.com/kf/201401/269896.html" target="_blank" rel="external">原文地址</a>。</p>
<h3 id="MainActivity如下"><a href="#MainActivity如下" class="headerlink" title="MainActivity如下:"></a>MainActivity如下:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cc.test;  </div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.HashSet;  </div><div class="line"><span class="keyword">import</span> java.util.Random;  </div><div class="line"><span class="keyword">import</span> android.app.Activity;  </div><div class="line"><span class="keyword">import</span> android.os.Bundle;  </div><div class="line"><span class="comment">/**</span></div><div class="line"> *  </div><div class="line"> * Demo描述:</div><div class="line"> * Java中利用Random生成随机数</div><div class="line"> *  </div><div class="line"> * 参考资料:</div><div class="line"> * 1 http://blog.csdn.net/herrapfel/article/details/1885016</div><div class="line"> * 2 http://blog.csdn.net/yuxuepiaoguo/article/details/4195198</div><div class="line"> * 3 http://blog.csdn.net/zhongyili_sohu/article/details/7906125</div><div class="line"> * 4 http://www.csdn.net/article/2012-03-22/313407</div><div class="line"> *   Thank you very much</div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestRandomActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;  </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;  </div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);  </div><div class="line">        setContentView(R.layout.main);  </div><div class="line">        testRandom1();  </div><div class="line">        testRandom2();  </div><div class="line">        testRandom3();  </div><div class="line">    &#125;  </div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">//生成随机数  </span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">testRandom1</span><span class="params">()</span></span>&#123;  </div><div class="line">        Random random=<span class="keyword">new</span> Random();  </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;<span class="number">5</span>; i++) &#123;  </div><div class="line">            System.out.println(<span class="string">"random.nextInt()="</span>+random.nextInt());  </div><div class="line">        &#125;  </div><div class="line">        System.out.println(<span class="string">"/////以上为testRandom1()的测试///////"</span>);  </div><div class="line">    &#125;  </div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">//在一定范围内生成随机数.  </span></div><div class="line">    <span class="comment">//比如此处要求在[0 - n)内生成随机数.  </span></div><div class="line">    <span class="comment">//注意:包含0不包含n  </span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">testRandom2</span><span class="params">()</span></span>&#123;  </div><div class="line">        Random random=<span class="keyword">new</span> Random();  </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;<span class="number">10</span>; i++) &#123;  </div><div class="line">            System.out.println(<span class="string">"random.nextInt()="</span>+random.nextInt(<span class="number">20</span>));  </div><div class="line">        &#125;  </div><div class="line">        System.out.println(<span class="string">"/////以上为testRandom2()的测试///////"</span>);  </div><div class="line">    &#125;  </div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">//在一定范围内生成不重复的随机数  </span></div><div class="line">    <span class="comment">//在testRandom2中生成的随机数可能会重复.  </span></div><div class="line">    <span class="comment">//在此处避免该问题  </span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">testRandom3</span><span class="params">()</span></span>&#123;  </div><div class="line">        HashSet&lt;integer&gt; integerHashSet=<span class="keyword">new</span> HashSet&lt;integer&gt;();  </div><div class="line">        Random random=<span class="keyword">new</span> Random();  </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;<span class="number">10</span>; i++) &#123;  </div><div class="line">            <span class="keyword">int</span> randomInt=random.nextInt(<span class="number">20</span>);  </div><div class="line">            System.out.println(<span class="string">"生成的randomInt="</span>+randomInt);  </div><div class="line">            <span class="keyword">if</span> (!integerHashSet.contains(randomInt)) &#123;  </div><div class="line">                integerHashSet.add(randomInt);  </div><div class="line">                System.out.println(<span class="string">"添加进HashSet的randomInt="</span>+randomInt);  </div><div class="line">            &#125;<span class="keyword">else</span> &#123;  </div><div class="line">                System.out.println(<span class="string">"该数字已经被添加,不能重复添加"</span>);  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">        System.out.println(<span class="string">"/////以上为testRandom3()的测试///////"</span>);  </div><div class="line">    &#125;  </div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</blockquote>
<h3 id="main-xml如下"><a href="#main-xml如下" class="headerlink" title="main.xml如下:"></a>main.xml如下:</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--?xml version="1.0" encoding="utf-8"?--&gt;</span>  </div><div class="line"><span class="tag">&lt;<span class="name">linearlayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span> <span class="attr">android:layout_width</span>=<span class="string">"fill_parent"</span> <span class="attr">android:layout_height</span>=<span class="string">"fill_parent"</span> <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;<span class="name">textview</span> <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span> <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> <span class="attr">android:text</span>=<span class="string">"Java中利用Random生成随机数"</span> <span class="attr">android:layout_gravity</span>=<span class="string">"center"</span> <span class="attr">android:layout_margintop</span>=<span class="string">"100dip"</span>&gt;</span>  </div><div class="line"><span class="tag">&lt;/<span class="name">textview</span>&gt;</span><span class="tag">&lt;/<span class="name">linearlayout</span>&gt;</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://WinterSmileSB101.online/2017/03/22/Android实践-自定义dialog从屏幕底部弹出并且充满屏幕宽度/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WinterSmileSB101">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WinterSmileSB101 的个人房间">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/22/Android实践-自定义dialog从屏幕底部弹出并且充满屏幕宽度/" itemprop="url">
                  Android实践-自定义dialog从屏幕底部弹出并且充满屏幕宽度
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-22T16:56:01+08:00">
                2017-03-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/Android-实战/" itemprop="url" rel="index">
                    <span itemprop="name">Android 实战</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>版权声明：本文为 wintersmilesb101 -（个人独立博客– <a href="http://wintersmilesb101.online">http://wintersmilesb101.online</a> 欢迎访问）博主转载文章，<a href="http://blog.csdn.net/nugongahou110/article/details/46780135" target="_blank" rel="external">原文地址</a>。</p>
</blockquote>
<h3 id="通常我们使用dialog的时候会遇到一些问题，比如我想用自己定义的布局来替代系统那个黑乎乎的布局时我要怎么做？我想要指定dialog从底部弹出而不是在屏幕中央弹出要怎么做？我设置了dialog布局的宽度为填充父窗体然而实际效果却不是充满全屏的，这时我该怎么做？"><a href="#通常我们使用dialog的时候会遇到一些问题，比如我想用自己定义的布局来替代系统那个黑乎乎的布局时我要怎么做？我想要指定dialog从底部弹出而不是在屏幕中央弹出要怎么做？我设置了dialog布局的宽度为填充父窗体然而实际效果却不是充满全屏的，这时我该怎么做？" class="headerlink" title="通常我们使用dialog的时候会遇到一些问题，比如我想用自己定义的布局来替代系统那个黑乎乎的布局时我要怎么做？我想要指定dialog从底部弹出而不是在屏幕中央弹出要怎么做？我设置了dialog布局的宽度为填充父窗体然而实际效果却不是充满全屏的，这时我该怎么做？"></a>通常我们使用dialog的时候会遇到一些问题，比如我想用自己定义的布局来替代系统那个黑乎乎的布局时我要怎么做？我想要指定dialog从底部弹出而不是在屏幕中央弹出要怎么做？我设置了dialog布局的宽度为填充父窗体然而实际效果却不是充满全屏的，这时我该怎么做？</h3><h3 id="我们先来看一个例子："><a href="#我们先来看一个例子：" class="headerlink" title="我们先来看一个例子："></a>我们先来看一个例子：</h3><p><img src="http://img.blog.csdn.net/20150706223900562?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="image"></p>
<h3 id="首先我们先来定义一个dialog的布局"><a href="#首先我们先来定义一个dialog的布局" class="headerlink" title="首先我们先来定义一个dialog的布局"></a>首先我们先来定义一个dialog的布局</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span> <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    &gt;</div><div class="line">    <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/bt_weixin"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"微信"</span></div><div class="line">        <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></div><div class="line">        <span class="attr">android:background</span>=<span class="string">"@color/material_blue_grey_800"</span>/&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/bt_weibo"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:background</span>=<span class="string">"#ef3254"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"微博"</span>/&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/bt_pengyouquan"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:background</span>=<span class="string">"#ef6d03"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"朋友圈"</span>/&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="activity-main-xml非常简单，只有一个button"><a href="#activity-main-xml非常简单，只有一个button" class="headerlink" title="activity_main.xml非常简单，只有一个button"></a>activity_main.xml非常简单，只有一个button</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span> <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    &gt;</div><div class="line">    <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/share"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"分享"</span> <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        /&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="接着我们要在res-values-styles-xml下定义dialog的样式以及dialog弹出时的动画"><a href="#接着我们要在res-values-styles-xml下定义dialog的样式以及dialog弹出时的动画" class="headerlink" title="接着我们要在res/values/styles.xml下定义dialog的样式以及dialog弹出时的动画"></a>接着我们要在res/values/styles.xml下定义dialog的样式以及dialog弹出时的动画</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 弹出框动画 由下至上 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"dialogStyle"</span> <span class="attr">parent</span>=<span class="string">"@android:style/Animation.Dialog"</span>&gt;</span><span class="xml"></span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"@android:windowEnterAnimation"</span>&gt;</span>@anim/dialog_enter<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 进入时的动画 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"@android:windowExitAnimation"</span>&gt;</span>@anim/dialog_exit<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 退出时的动画 --&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"></div><div class="line"> <span class="comment">&lt;!-- 对话框样式 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"Theme.Light.Dialog"</span> <span class="attr">parent</span>=<span class="string">"android:style/Theme.Dialog"</span>&gt;</span><span class="xml"></span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowBackground"</span>&gt;</span>@android:color/transparent<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowNoTitle"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowIsFloating"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowContentOverlay"</span>&gt;</span>@null<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:scrollHorizontally"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="接着我们在res下新建一个anim文件夹，在res-values-anim下新建两个xml文件"><a href="#接着我们在res下新建一个anim文件夹，在res-values-anim下新建两个xml文件" class="headerlink" title="接着我们在res下新建一个anim文件夹，在res/values/anim下新建两个xml文件"></a>接着我们在res下新建一个anim文件夹，在res/values/anim下新建两个xml文件</h3><p><img src="http://img.blog.csdn.net/20150706225028841" alt="image"></p>
<h3 id="dialog-enter-xml和dialog-exit-xml如下"><a href="#dialog-enter-xml和dialog-exit-xml如下" class="headerlink" title="dialog_enter.xml和dialog_exit.xml如下"></a>dialog_enter.xml和dialog_exit.xml如下</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">translate</span> <span class="attr">android:fromYDelta</span>=<span class="string">"100%"</span></span></div><div class="line">        <span class="attr">android:duration</span>=<span class="string">"600"</span>&gt;<span class="tag">&lt;/<span class="name">translate</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">translate</span> <span class="attr">android:toYDelta</span>=<span class="string">"100%"</span></span></div><div class="line">        <span class="attr">android:duration</span>=<span class="string">"600"</span>&gt;<span class="tag">&lt;/<span class="name">translate</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="最后是MainActivity-Java"><a href="#最后是MainActivity-Java" class="headerlink" title="最后是MainActivity.Java"></a>最后是MainActivity.Java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Button btShare;</div><div class="line">    <span class="keyword">private</span> Context mContext;</div><div class="line">    <span class="keyword">private</span> Button btWeixin;</div><div class="line">    <span class="keyword">private</span> Button btWeibo;</div><div class="line">    <span class="keyword">private</span> Button btPengyouquan;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        mContext = MainActivity.<span class="keyword">this</span>;</div><div class="line">        btShare = (Button) findViewById(R.id.share);</div><div class="line">        btShare.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">                <span class="keyword">final</span> Dialog dialog = <span class="keyword">new</span> Dialog(mContext, R.style.Theme_Light_Dialog);</div><div class="line">                View dialogView = LayoutInflater.from(mContext).inflate(R.layout.my_dialog,<span class="keyword">null</span>);</div><div class="line">                <span class="comment">//获得dialog的window窗口</span></div><div class="line">                Window window = dialog.getWindow();</div><div class="line">                <span class="comment">//设置dialog在屏幕底部</span></div><div class="line">                window.setGravity(Gravity.BOTTOM);</div><div class="line">                <span class="comment">//设置dialog弹出时的动画效果，从屏幕底部向上弹出</span></div><div class="line">                window.setWindowAnimations(R.style.dialogStyle);</div><div class="line">                window.getDecorView().setPadding(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">                <span class="comment">//获得window窗口的属性</span></div><div class="line">                android.view.WindowManager.LayoutParams lp = window.getAttributes();</div><div class="line">                <span class="comment">//设置窗口宽度为充满全屏</span></div><div class="line">                lp.width = WindowManager.LayoutParams.MATCH_PARENT;</div><div class="line">                <span class="comment">//设置窗口高度为包裹内容</span></div><div class="line">                lp.height = WindowManager.LayoutParams.WRAP_CONTENT;</div><div class="line">                <span class="comment">//将设置好的属性set回去</span></div><div class="line">                window.setAttributes(lp);</div><div class="line">                <span class="comment">//将自定义布局加载到dialog上</span></div><div class="line">                dialog.setContentView(dialogView);</div><div class="line">                btWeixin = (Button) dialogView.findViewById(R.id.bt_weixin);</div><div class="line">                btWeibo = (Button) dialogView.findViewById(R.id.bt_weibo);</div><div class="line">                btPengyouquan = (Button) dialogView.findViewById(R.id.bt_pengyouquan);</div><div class="line">                dialog.show();</div><div class="line">                btWeixin.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">                        Toast.makeText(mContext,<span class="string">"分享到微信"</span>,Toast.LENGTH_SHORT).show();</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">                btWeibo.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">                        Toast.makeText(mContext,<span class="string">"分享到微博"</span>,Toast.LENGTH_SHORT).show();</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">                btPengyouquan.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">                        Toast.makeText(mContext,<span class="string">"分享到朋友圈"</span>,Toast.LENGTH_SHORT).show();</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="WinterSmileSB101" />
          <p class="site-author-name" itemprop="name">WinterSmileSB101</p>
           
              <p class="site-description motion-element" itemprop="description">成都工业学院14级，学习了各种后台技能，对前端也甚是抱有好感，准备再入坑前端。</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">43</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">19</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">96</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">WinterSmileSB101</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  






  





  

  

  

  

</body>
</html>
